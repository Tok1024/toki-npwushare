# 🚀 NWPUShare 二次开发完整指南

> 基于 TouchGAL 项目快速搭建西工大资源共享平台

## 📋 开发路线图

```
阶段 0: 环境搭建 (1小时)
   ↓
阶段 1: 清理 TouchGAL 遗留代码 (2-3小时) ⭐ 优先
   ↓
阶段 2: 修复登录和注册功能 (1-2小时) ⭐ 核心
   ↓
阶段 3: 选择邮箱验证码方案 (30分钟)
   ↓
阶段 4: 品牌定制与数据初始化 (2-3小时)
   ↓
阶段 5: 功能测试与部署 (2小时)
   ↓
🎉 MVP 上线！(总计: 8-12小时)
```

---

## 🎯 现状评估

### ✅ 功能正常，可以保留

- ✓ 文件链接上传功能（仅存链接，不存文件）
- ✓ 用户评论功能（支持嵌套回复）
- ✓ 课程反馈功能（点赞、难度评分）
- ✓ 课程浏览和搜索
- ✓ Prisma 数据模型设计

### ⚠️ 需要修复

- ✗ 用户登录功能（已修复，见阶段 2）
- ✗ 用户注册功能（已修复，见阶段 2）
- ✗ 邮箱验证码发送（需要选择方案，见阶段 3）

### 🧹 需要清理（影响观感）

- 🗑️ TouchGAL/Galgame 品牌名称
- 🗑️ 旧补丁站的 UI 组件和文案
- 🗑️ 无用的 API 路由
- 🗑️ Legacy 数据模型引用

---

## 阶段 0: 环境搭建 (1小时)

### 系统要求

- Node.js 18+ (推荐 20+)
- PostgreSQL 14+
- Redis 6+
- pnpm 8+

### 快速启动

```bash
# 1. 安装依赖
pnpm install

# 2. 启动数据库服务
brew services start postgresql@14
brew services start redis

# 3. 配置环境（使用我提供的开发配置）
cp .env.development .env

# 编辑 .env，修改数据库连接：
# KUN_DATABASE_URL="postgresql://你的用户名:你的密码@localhost:5432/nwpushare"

# 4. 初始化数据库
pnpm prisma:generate
pnpm prisma:push

# 5. 填充示例数据
pnpm run seed:courses

# 6. 启动开发服务器
pnpm dev
```

### 验证环境

访问 http://127.0.0.1:3000

- 能看到首页 ✓
- 能浏览课程列表 ✓
- 能用 seed@example.com / 123 登录 ✓

**如果遇到问题，查看：** `docs/QUICKSTART.md`

---

## 阶段 1: 清理 TouchGAL 遗留代码 (2-3小时) ⭐

### 为什么要先清理？

1. **品牌统一：** 去除 TouchGAL/Galgame 相关名称
2. **代码可维护：** 清理无用代码，便于后续开发
3. **用户体验：** 改善界面文案，符合学习资源站定位

### 清理清单

详见：**`docs/CLEANUP-GUIDE.md`** （下一步创建）

**核心任务：**

1. 批量重命名变量和函数
2. 清理无用的 API 路由
3. 修改 UI 文案和导航
4. 清理旧的 Prisma 模型引用

**预计耗时：** 2-3 小时
**难度：** ⭐⭐☆☆☆ (大部分是批量替换)

---

## 阶段 2: 修复登录和注册功能 (1-2小时) ⭐

### 已完成的修复

我已经帮你修复了以下问题：

1. ✅ **IP 获取问题** - 开发环境使用默认 IP
2. ✅ **人机验证问题** - 开发环境可以跳过
3. ✅ **邮件发送问题** - 开发环境验证码打印到控制台
4. ✅ **环境配置** - 创建了 `.env.development`

### 测试验证

详见：**`docs/FIX-REPORT.md`** 和 **`docs/QUICKSTART.md`**

```bash
# 测试登录
# 访问 http://127.0.0.1:3000/login
# 输入：seed@example.com / 123
# 应该能成功登录 ✓

# 测试注册
# 访问 http://127.0.0.1:3000/register
# 填写表单 → 发送验证码 → 查看终端输出
# 输入验证码 1234567 → 注册成功 ✓
```

**预计耗时：** 30分钟-1小时（测试和验证）
**难度：** ⭐☆☆☆☆ (已修复，只需测试)

---

## 阶段 3: 选择邮箱验证码方案 (30分钟)

### 方案对比

详见：**`docs/EMAIL-SOLUTIONS.md`** （下一步创建）

| 方案               | 成本           | 难度      | 推荐度           |
| ------------------ | -------------- | --------- | ---------------- |
| **Resend**         | 免费 3000封/月 | ⭐⭐☆☆☆   | ⭐⭐⭐⭐⭐ 推荐  |
| **SendGrid**       | 免费 100封/天  | ⭐⭐⭐☆☆  | ⭐⭐⭐⭐☆        |
| **阿里云邮件推送** | ￥0.11/千封    | ⭐⭐☆☆☆   | ⭐⭐⭐☆☆ (国内)  |
| **个人 SMTP**      | 免费           | ⭐⭐⭐⭐☆ | ⭐⭐☆☆☆ (易被封) |

**我的推荐：Resend**

- 每月 3000 封免费额度
- 集成简单（5 分钟配置）
- 发送速度快，到达率高
- 有详细的邮件日志

**预计耗时：** 30分钟（配置+测试）
**难度：** ⭐⭐☆☆☆

---

## 阶段 4: 品牌定制与数据初始化 (2-3小时)

### 4.1 品牌定制 (1小时)

**修改文件清单：**

```bash
# 1. 网站元数据
app/metadata.ts         # 标题、描述、关键词
public/favicon.ico      # 网站图标

# 2. 首页
app/page.tsx            # Hero 区文案
components/home/*       # 首页组件

# 3. 导航和页脚
components/kun/top-bar/TopBar.tsx   # 导航栏
components/kun/Footer.tsx           # 页脚

# 4. 文档
README.md               # 项目说明
package.json            # 项目名称
```

**示例修改：**

```typescript
// app/metadata.ts
export const generateKunMetadata = () => ({
  title: 'NWPUShare - 西北工业大学资源共享平台',
  description: '西工大学生自发维护的课程资料共享站，汇集课件、笔记、经验分享',
  keywords: ['西北工业大学', '课程资料', '学习笔记', 'NWPU', '资源共享']
})
```

### 4.2 数据初始化 (1-2小时)

**修改 `scripts/seedCourses.ts`：**

```typescript
// 示例：添加西工大的学院和课程
const departments = [
  {
    slug: 'aerospace',
    name: '航天学院',
    courses: [
      {
        slug: 'aerospace-dynamics',
        name: '航天动力学',
        code: 'AERO2001',
        tags: ['必修', '大二', '力学']
        // ...
      }
    ]
  },
  {
    slug: 'cs',
    name: '计算机学院',
    courses: [
      {
        slug: 'data-structure',
        name: '数据结构',
        code: 'CS2002',
        tags: ['必修', '大二', '编程']
        // ...
      }
    ]
  }
  // ... 更多学院
]
```

**重新填充数据：**

```bash
# 清空数据库
pnpm prisma:push --force-reset

# 重新填充
pnpm run seed:courses
```

**预计耗时：** 2-3小时
**难度：** ⭐⭐⭐☆☆

---

## 阶段 5: 功能测试与部署 (2小时)

### 5.1 功能测试 (1小时)

**测试清单：**

- [ ] 用户注册（使用真实邮箱）
- [ ] 用户登录
- [ ] 浏览课程列表
- [ ] 查看课程详情
- [ ] 上传资源（外链）
- [ ] 发表评论
- [ ] 提交课程反馈
- [ ] 搜索功能
- [ ] 响应式设计（手机端）

### 5.2 部署 (1小时)

**推荐方案：Vercel + Supabase**

```bash
# 1. 准备生产环境配置
cp .env.development .env.production

# 2. 修改生产环境配置
# - 禁用开发模式开关
# - 配置真实的邮件服务
# - 配置生产数据库

# 3. 部署到 Vercel
vercel --prod
```

**详细部署指南：** 见 `docs/DEPLOYMENT.md`

**预计耗时：** 1-2小时
**难度：** ⭐⭐⭐☆☆

---

## 📚 文档索引

### 核心文档（必读）

1. **`docs/QUICKSTART.md`** - 快速启动指南（5分钟跑起来）
2. **`docs/CLEANUP-GUIDE.md`** - TouchGAL 清理指南（详细步骤）
3. **`docs/FIX-REPORT.md`** - 登录注册修复报告（已完成）
4. **`docs/EMAIL-SOLUTIONS.md`** - 邮箱验证码方案对比

### 参考文档

- `docs/system-architecture.md` - 系统架构说明（了解项目结构）
- `docs/improvement-guide.md` - 改进路线图（后续迭代）
- `docs/manual-testing-guide.md` - 手动测试指南
- `11-11.md` - 项目现状（原作者记录）
- `11-19-codex.md` - 后端学习路线

---

## ⏱️ 时间规划

### 周末方案（2天完成 MVP）

**Day 1 上午 (3-4小时)**

- [ ] 环境搭建 (1h)
- [ ] 清理 TouchGAL 代码 (2-3h)

**Day 1 下午 (3-4小时)**

- [ ] 测试登录注册 (1h)
- [ ] 配置邮箱验证码 (30min)
- [ ] 品牌定制 (1-2h)

**Day 2 上午 (2-3小时)**

- [ ] 数据初始化 (1-2h)
- [ ] 功能测试 (1h)

**Day 2 下午 (2小时)**

- [ ] 部署上线 (1h)
- [ ] 邀请测试用户 (1h)

### 工作日方案（1周完成）

**周一：** 环境搭建 + 清理代码（第1-2阶段）
**周二：** 修复功能 + 邮箱配置（第2-3阶段）
**周三：** 品牌定制（第4阶段前半）
**周四：** 数据初始化（第4阶段后半）
**周五：** 测试 + 部署（第5阶段）

---

## 🎯 核心原则

### 1. 循序渐进，不要跳步

❌ **错误做法：**

- 先改品牌，后清理代码 → 会重复修改
- 先部署，后测试 → 生产环境出问题

✅ **正确做法：**

- 按阶段顺序进行
- 每个阶段完成后测试一次
- 确认无误再进入下一阶段

### 2. 保留有用功能，清理垃圾代码

✅ **保留：**

- 课程、资源、评论、反馈模型和 API
- 用户认证基础框架
- Prisma 数据模型设计

🗑️ **清理：**

- TouchGAL/Galgame 品牌名称
- 旧补丁站的特定功能（如：补丁下载）
- 不再使用的 API 路由

### 3. 开发环境优先易用，生产环境优先安全

**开发环境：**

- 跳过人机验证
- 验证码打印到控制台
- IP 使用默认值

**生产环境：**

- 启用人机验证
- 真实邮件发送
- 严格 IP 检查

---

## 🆘 遇到问题？

### 常见问题速查

1. **数据库连接失败**
   - 检查 PostgreSQL 是否运行：`brew services list`
   - 检查连接字符串：`KUN_DATABASE_URL`

2. **Redis 连接失败**
   - 检查 Redis 是否运行：`redis-cli ping`
   - 应该返回 `PONG`

3. **登录后立即退出**
   - 清除浏览器 Cookie
   - 检查 JWT_SECRET 是否配置
   - 确保使用 `http://127.0.0.1:3000` 访问

4. **找不到验证码**
   - 查看运行 `pnpm dev` 的终端输出
   - 找到 `[dev-email-code]` 开头的日志

**更多问题：** 查看 `docs/QUICKSTART.md` 的"常见问题排查"部分

---

## 📖 推荐学习路径

### 第一次接触项目？

1. **先读懂架构** (30分钟)
   - 读：`docs/system-architecture.md`
   - 理解：前端/后端/数据层的分工

2. **跟踪一个完整流程** (1小时)
   - 选择：课程详情页
   - 从页面 → API → 数据库，完整跟踪一遍

3. **尝试小改动** (1小时)
   - 修改首页文案
   - 修改课程列表排序
   - 给导航栏加一个链接

### 想深入学习后端？

参考：`docs/11-19-codex.md`（后端学习路线）

### 想深入学习前端？

参考：Next.js 15 官方文档 + HeroUI 组件库文档

---

## 🎉 完成 MVP 后

### 继续改进

- [ ] 完善课程帖子功能（创建、编辑、删除）
- [ ] 开发资源审核后台
- [ ] 添加更多筛选条件
- [ ] 优化搜索功能
- [ ] 添加用户头像上传
- [ ] 集成第三方登录（GitHub、微信）

### 运营推广

- [ ] 邀请同学测试
- [ ] 收集反馈
- [ ] 完善内容（添加更多课程资源）
- [ ] 宣传推广（校内论坛、微信群）

---

## 💡 提示

- **不要追求完美：** MVP 的目标是快速验证想法，不是做到 100 分
- **先跑起来，再优化：** 能用 > 好用 > 完美
- **持续迭代：** 每周发布一个小更新，比一次性大更新更好

---

## 📞 获取帮助

- **项目文档：** `docs/` 目录
- **代码注释：** 关键文件都有详细注释
- **Prisma 文档：** https://www.prisma.io/docs
- **Next.js 文档：** https://nextjs.org/docs
- **HeroUI 文档：** https://heroui.com

**祝你开发顺利！🚀**
