// role: 1 - user, 2 - publisher, 3 - admin, 4 - super admin
model user {
  id                      Int      @id @default(autoincrement())
  name                    String   @unique @db.VarChar(17)
  email                   String   @unique @db.VarChar(255)  // MySQL utf8mb4索引限制，从1007改为255
  password                String   @db.VarChar(1007)
  ip                      String   @default("") @db.VarChar(233)
  avatar                  String   @default("") @db.VarChar(233)
  role                    Int      @default(1)
  status                  Int      @default(0)
  register_time           DateTime @default(now())
  point                   Int      @default(0)
  bio                     String   @default("") @db.VarChar(107)
  resource_upload_count   Int      @default(0)
  resource_download_count Int      @default(0)
  contribution_score      Int      @default(0)

  enable_email_notice Boolean @default(true)
  daily_image_count   Int     @default(0)
  daily_check_in      Int     @default(0)
  daily_upload_size   Float   @default(0)
  last_login_time     String  @default("")

  admin_log admin_log[]

  following user_follow_relation[] @relation("user_following")
  follower  user_follow_relation[] @relation("user_follower")

  course_resource resource[] @relation("user_course_resource")
  send_message    user_message[] @relation("user_send_message")
  receive_message user_message[] @relation("user_receive_message")

  course_feedback       course_feedback[]
  resource_ratings      resource_rating[]
  resource_interactions resource_interaction[]
  posts                 post[]
  comments              comment[]
  course_comment_like   course_comment_like[]  @relation("user_course_comment_like")
  course_favorites      course_favorite[]      @relation("user_course_favorite")
  badges                user_badge[]

  created DateTime @default(now())
  updated DateTime @updatedAt
}

model user_follow_relation {
  id Int @id @default(autoincrement())

  follower_id  Int
  following_id Int

  follower  user @relation("user_follower", fields: [follower_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  following user @relation("user_following", fields: [following_id], references: [id])

  @@unique([follower_id, following_id])
}

// status: 0 - unread, 1 - read, 2 - approve, 3 - decline
model user_message {
  id      Int    @id @default(autoincrement())
  type    String
  content String @db.VarChar(10007)
  status  Int    @default(0)
  link    String @default("") @db.VarChar(1007)

  sender_id    Int?
  sender       user? @relation("user_send_message", fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recipient_id Int?
  recipient    user? @relation("user_receive_message", fields: [recipient_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  created DateTime @default(now())
  updated DateTime @updatedAt
}
