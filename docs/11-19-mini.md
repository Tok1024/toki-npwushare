# NWPUShare åˆå­¦è€…å®Œå…¨æŒ‡å— ğŸ“š

> ç‰ˆæœ¬ï¼š2025-11-19
> ç›®æ ‡è¯»è€…ï¼šNext.js å’Œ Web å¼€å‘åˆå­¦è€…
> é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š2-3 å‘¨ï¼ˆæ¯å¤© 2-3 å°æ—¶ï¼‰

---

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°ä¸å®šä½](#1-é¡¹ç›®æ¦‚è¿°ä¸å®šä½)
2. [æŠ€æœ¯æ¶æ„æ·±åº¦è§£æ](#2-æŠ€æœ¯æ¶æ„æ·±åº¦è§£æ)
3. [æ•°æ®æ¨¡å‹è¯¦è§£](#3-æ•°æ®æ¨¡å‹è¯¦è§£)
4. [æ ¸å¿ƒåŠŸèƒ½æµç¨‹](#4-æ ¸å¿ƒåŠŸèƒ½æµç¨‹)
5. [å½“å‰å­˜åœ¨çš„é—®é¢˜](#5-å½“å‰å­˜åœ¨çš„é—®é¢˜)
6. [å®Œæ•´TODOæ¸…å•](#6-å®Œæ•´todoæ¸…å•)
7. [å®è·µè·¯çº¿å›¾](#7-å®è·µè·¯çº¿å›¾)
8. [å¸¸è§é—®é¢˜è§£ç­”](#8-å¸¸è§é—®é¢˜è§£ç­”)

---

## 1. é¡¹ç›®æ¦‚è¿°ä¸å®šä½

### 1.1 ä»€ä¹ˆæ˜¯ NWPUShareï¼Ÿ

NWPUShare æ˜¯ä¸€ä¸ªé¢å‘é«˜æ ¡å­¦ç”Ÿçš„**è¯¾ç¨‹èµ„æºåˆ†äº«ä¸è®¨è®ºå¹³å°**ï¼Œå‰èº«æ˜¯ TouchGalï¼ˆä¸€ä¸ª Galgame æ–‡åŒ–ç¤¾åŒºï¼‰ã€‚é¡¹ç›®æ­£åœ¨è¿›è¡Œå“ç‰Œé‡å¡‘ï¼Œä»æ¸¸æˆç¤¾åŒºè½¬å‹ä¸ºå­¦ä¹ å¹³å°ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

- **è¯¾ç¨‹èµ„æºåˆ†äº«**ï¼šä¸Šä¼ è¯¾ä»¶ã€ç¬”è®°ã€ä½œä¸šã€è¯•å·ã€ç­”æ¡ˆç­‰
- **è¯¾ç¨‹è®¨è®º**ï¼šå­¦ç”Ÿå¯ä»¥é’ˆå¯¹è¯¾ç¨‹æé—®ã€è®¨è®º
- **è¯¾ç¨‹è¯„ä»·**ï¼šçº¢å¿ƒç‚¹èµã€éš¾åº¦è¯„åˆ†ã€çŸ­è¯„åé¦ˆ
- **å­¦é™¢ç»„ç»‡**ï¼šæŒ‰å­¦é™¢/è¯¾ç¨‹åˆ†ç±»æµè§ˆ
- **ç»éªŒå¸–å­**ï¼šå­¦ä¹ ç»éªŒåˆ†äº«
- **èµ„æºå®¡æ ¸**ï¼šç®¡ç†å‘˜å®¡æ ¸å¾…å‘å¸ƒèµ„æº

### 1.3 æŠ€æœ¯æ ˆæ€»è§ˆ

| é¢†åŸŸ       | æŠ€æœ¯é€‰æ‹©               | è¯´æ˜                 |
| ---------- | ---------------------- | -------------------- |
| å‰ç«¯æ¡†æ¶   | Next.js 15.4.4         | ä½¿ç”¨ App Router æ¶æ„ |
| UI ç»„ä»¶åº“  | HeroUI 2.8.1           | åŸºäº React çš„ç»„ä»¶åº“  |
| æ ·å¼æ–¹æ¡ˆ   | Tailwind CSS 4.1.11    | åŸå­åŒ– CSS æ¡†æ¶      |
| åç«¯ API   | Next.js Route Handlers | API è·¯ç”±             |
| æ•°æ®åº“     | PostgreSQL             | ä¸»æ•°æ®åº“             |
| ORM        | Prisma 6.16.2          | æ•°æ®åº“æ“ä½œ           |
| ç¼“å­˜       | Redis                  | JWT/ä¼šè¯ç¼“å­˜         |
| çŠ¶æ€ç®¡ç†   | Zustand 5.0.6          | å‰ç«¯çŠ¶æ€ç®¡ç†         |
| è¡¨å•å¤„ç†   | React Hook Form 7.61.1 | è¡¨å•çŠ¶æ€ç®¡ç†         |
| æ•°æ®éªŒè¯   | Zod 3.25.48            | TypeScript ä¼˜å…ˆéªŒè¯  |
| å¯Œæ–‡æœ¬ç¼–è¾‘ | Milkdown 7.15.2        | Markdown ç¼–è¾‘å™¨      |
| éƒ¨ç½²       | PM2 / Docker           | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²         |

---

## 2. æŠ€æœ¯æ¶æ„æ·±åº¦è§£æ

### 2.1 Next.js App Router æ¶æ„

Next.js 15 ä½¿ç”¨ App Routerï¼Œè¿™æ˜¯ç†è§£é¡¹ç›®çš„å…³é”®ã€‚ç»“æ„å¦‚ä¸‹ï¼š

```
app/
â”œâ”€â”€ (auth)/
â”‚   â”œâ”€â”€ login/
â”‚   â””â”€â”€ register/
â”œâ”€â”€ api/              # API è·¯ç”±ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ course/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ user/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ course/           # é¡µé¢ï¼ˆå‰ç«¯ï¼‰
â”‚   â”œâ”€â”€ [dept]/
â”‚   â”‚   â””â”€â”€ [slug]/
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ edit/
â””â”€â”€ page.tsx          # é¦–é¡µ
```

**å…³é”®æ¦‚å¿µï¼š**

- **Server Component**ï¼šé»˜è®¤æ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼ˆå¦‚ `app/course/[dept]/[slug]/page.tsx`ï¼‰
- **Client Component**ï¼šä»¥ `'use client'` å¼€å¤´ï¼Œç”¨äºäº¤äº’ï¼ˆå¦‚è¯„è®ºç‚¹èµã€ç­›é€‰ï¼‰
- **Route Handler**ï¼š`app/api/**/*.ts`ï¼Œå¤„ç† API è¯·æ±‚
- **å¸ƒå±€**ï¼š`layout.tsx` å®šä¹‰é¡µé¢å¸ƒå±€
- **åŠ¨æ€è·¯ç”±**ï¼š`[dept]/[slug]` è¡¨ç¤ºåŠ¨æ€å‚æ•°

### 2.2 API è·¯ç”±è¯¦è§£

æ‰€æœ‰ API éƒ½åœ¨ `app/api/` ä¸‹ï¼Œä½¿ç”¨æ ‡å‡†çš„ HTTP æ–¹æ³•ï¼š

#### è¯¾ç¨‹ç›¸å…³ API

| æ–¹æ³• | è·¯å¾„                                     | åŠŸèƒ½                       | æ–‡ä»¶ä½ç½®                                             |
| ---- | ---------------------------------------- | -------------------------- | ---------------------------------------------------- |
| GET  | `/api/course/list`                       | è·å–è¯¾ç¨‹åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰ | `app/api/course/list/route.ts`                       |
| GET  | `/api/course/[dept]/[slug]`              | è·å–è¯¾ç¨‹è¯¦æƒ…               | `app/api/course/[dept]/[slug]/route.ts`              |
| GET  | `/api/course/[dept]/[slug]/resources`    | è·å–è¯¾ç¨‹èµ„æºåˆ—è¡¨           | `app/api/course/[dept]/[slug]/resources/route.ts`    |
| POST | `/api/course/[dept]/[slug]/resources`    | ä¸Šä¼ èµ„æºï¼ˆpending çŠ¶æ€ï¼‰   | åŒä¸Š                                                 |
| GET  | `/api/course/[dept]/[slug]/posts`        | è·å–è¯¾ç¨‹å¸–å­               | `app/api/course/[dept]/[slug]/posts/route.ts`        |
| GET  | `/api/course/[dept]/[slug]/comment`      | è·å–è¯¾ç¨‹è¯„è®º               | `app/api/course/[dept]/[slug]/comment/route.ts`      |
| POST | `/api/course/[dept]/[slug]/comment`      | å‘å¸ƒè¯„è®º                   | åŒä¸Š                                                 |
| PUT  | `/api/course/[dept]/[slug]/comment/like` | ç‚¹èµ/å–æ¶ˆç‚¹èµè¯„è®º          | `app/api/course/[dept]/[slug]/comment/like/route.ts` |
| GET  | `/api/course/[dept]/[slug]/rating`       | è·å–è¯¾ç¨‹åé¦ˆ               | `app/api/course/[dept]/[slug]/rating/route.ts`       |
| POST | `/api/course/[dept]/[slug]/rating`       | æäº¤è¯¾ç¨‹åé¦ˆ               | åŒä¸Š                                                 |

#### è®¤è¯ç›¸å…³ API

| æ–¹æ³• | è·¯å¾„                   | åŠŸèƒ½     | æ–‡ä»¶ä½ç½®                           |
| ---- | ---------------------- | -------- | ---------------------------------- |
| POST | `/api/auth/login`      | ç”¨æˆ·ç™»å½• | `app/api/auth/login/route.ts`      |
| POST | `/api/auth/register`   | ç”¨æˆ·æ³¨å†Œ | `app/api/auth/register/route.ts`   |
| POST | `/api/auth/verify-2fa` | éªŒè¯ 2FA | `app/api/auth/verify-2fa/route.ts` |
| POST | `/api/auth/captcha`    | éªŒè¯ç    | `app/api/auth/captcha/route.ts`    |

**API è®¾è®¡æ¨¡å¼ï¼š**

1. **åŠ¨æ€è·¯ç”±å‚æ•°**ï¼šä½¿ç”¨ `[dept]/[slug]` æ•è·è·¯å¾„å‚æ•°
2. **Zod éªŒè¯**ï¼šæ‰€æœ‰è¾“å…¥éƒ½é€šè¿‡ Zod schema éªŒè¯
3. **ç»Ÿä¸€å“åº”**ï¼šä½¿ç”¨ `NextResponse.json()` è¿”å›
4. **é”™è¯¯å¤„ç†**ï¼šè¿”å›é”™è¯¯å­—ç¬¦ä¸²æˆ–æŠ›å‡ºå¼‚å¸¸

**ç¤ºä¾‹ï¼šè¯¾ç¨‹è¯¦æƒ… API**ï¼ˆ`app/api/course/[dept]/[slug]/route.ts`ï¼‰

```typescript
import { NextResponse } from 'next/server'
import { prisma } from '~/prisma'

export const GET = async (
  _req: Request,
  { params }: { params: Promise<{ dept: string; slug: string }> }
) => {
  // 1. è·å–è·¯å¾„å‚æ•°
  const { dept, slug } = await params

  // 2. æŸ¥æ‰¾å­¦é™¢
  const department = await prisma.department.findUnique({
    where: { slug: dept }
  })
  if (!department) {
    return NextResponse.json('å­¦é™¢ä¸å­˜åœ¨')
  }

  // 3. æŸ¥æ‰¾è¯¾ç¨‹ï¼ˆä½¿ç”¨ç»„åˆå”¯ä¸€ç´¢å¼•ï¼‰
  const course = await prisma.course.findUnique({
    where: { department_id_slug: { department_id: department.id, slug } },
    include: { department: true }
  })

  // 4. æŸ¥æ‰¾å‚ä¸æ•™å¸ˆ
  const teachers = await prisma.course_teacher.findMany({
    where: { course_id: course.id },
    include: { teacher: true }
  })

  // 5. è¿”å›æ•°æ®
  return NextResponse.json({ course, teachers: teachers.map((t) => t.teacher) })
}
```

**å…³é”®ç‚¹ï¼š**

- ä½¿ç”¨ `prisma` æŸ¥è¯¢æ•°æ®åº“
- è·¯å¾„å‚æ•°é€šè¿‡ `params` è·å–
- ç»„åˆæŸ¥è¯¢ä½¿ç”¨ `department_id_slug`ï¼ˆåœ¨ Prisma model ä¸­å®šä¹‰ï¼‰
- å…³è”æŸ¥è¯¢ä½¿ç”¨ `include`

### 2.3 å‰ç«¯æ•°æ®è·å–

#### Server Componentï¼ˆæœåŠ¡ç«¯ç»„ä»¶ï¼‰

ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼ŒSEO å‹å¥½ï¼š

```typescript
// app/course/[dept]/[slug]/page.tsx
async function getCourseDetail(dept: string, slug: string) {
  const base =
    process.env.NODE_ENV === 'development'
      ? process.env.NEXT_PUBLIC_KUN_PATCH_ADDRESS_DEV
      : process.env.NEXT_PUBLIC_KUN_PATCH_ADDRESS_PROD

  const res = await fetch(`${base}/api/course/${dept}/${slug}`, {
    cache: 'no-store' // å®æ—¶æ•°æ®
  })
  return res.json()
}

export default async function Page({ params }) {
  const data = await getCourseDetail(dept, slug)
  // ...
}
```

#### Client Componentï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰

ç”¨äºäº¤äº’ï¼Œä½¿ç”¨ `kunFetchGet/Post/Put/Delete`ï¼š

```typescript
// components/course/Comments.tsx
const res = await kunFetchGet<PatchComment[]>(`/course/${dept}/${slug}/comment`)
```

#### kunFetch å·¥å…·

ç»Ÿä¸€ API è°ƒç”¨å°è£…ï¼ˆ`utils/kunFetch.ts`ï¼‰ï¼š

```typescript
// GET è¯·æ±‚
export const kunFetchGet = async <T>(
  url: string,
  query?: Record<string, string | number>
): Promise<T> => {
  return kunFetchRequest<T>(url, 'GET', { query })
}

// POST è¯·æ±‚
export const kunFetchPost = async <T>(
  url: string,
  body?: Record<string, unknown>
): Promise<T> => {
  return kunFetchRequest<T>(url, 'POST', { body })
}

// PUT/DELETE ç±»ä¼¼...
```

**ç‰¹æ€§ï¼š**

- è‡ªåŠ¨å¤„ç†ç¯å¢ƒå˜é‡ï¼ˆå¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼‰
- é»˜è®¤åŒ…å« `credentials`ï¼ˆCookieï¼‰
- è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- é”™è¯¯å¤„ç†

---

## 3. æ•°æ®æ¨¡å‹è¯¦è§£

### 3.1 å…³ç³»å‹æ•°æ®åº“è®¾è®¡

ä½¿ç”¨ Prisma ORMï¼Œæ“ä½œæ•°æ®åº“æ›´å®‰å…¨ã€ç±»å‹åŒ–ã€‚æ¨¡å‹æ–‡ä»¶ä½äº `prisma/schema/`ï¼Œæ‹†åˆ†å¦‚ä¸‹ï¼š

- `course.prisma`ï¼šè¯¾ç¨‹ç›¸å…³æ ¸å¿ƒæ¨¡å‹
- `user.prisma`ï¼šç”¨æˆ·æ¨¡å‹
- `admin.prisma`ï¼šç®¡ç†åå°æ¨¡å‹
- `schema.prisma`ï¼šä¸»å…¥å£æ–‡ä»¶ï¼Œå¯¼å…¥å…¶ä»–æ¨¡å‹

### 3.2 æ ¸å¿ƒæ¨¡å‹è¯¦è§£

#### 3.2.1 Departmentï¼ˆå­¦é™¢ï¼‰

```prisma
model department {
  id           Int      @id @default(autoincrement())
  slug         String   @unique  // URL å‹å¥½åç§°ï¼Œå¦‚ "cs", "ee"
  code         String?  @unique  // å­¦é™¢ä»£ç ï¼Œå¦‚ "CS"
  name         String   // å­¦é™¢å…¨å
  description  String?
  created      DateTime @default(now())
  updated      DateTime @updatedAt

  courses      course[] // ä¸€ä¸ªå­¦é™¢æœ‰å¤šé—¨è¯¾ç¨‹
  teachers     teacher[] // ä¸€ä¸ªå­¦é™¢æœ‰å¤šä½æ•™å¸ˆ
}
```

**ç”¨æ³•ï¼š**

```typescript
// æŸ¥æ‰¾å­¦é™¢
const dept = await prisma.department.findUnique({
  where: { slug: 'cs' } // é€šè¿‡ slug æŸ¥æ‰¾
})

// å…³è”æŸ¥è¯¢ï¼šè·å–å­¦é™¢çš„æ‰€æœ‰è¯¾ç¨‹
const courses = await prisma.course.findMany({
  where: { department_id: dept.id }
})
```

#### 3.2.2 Courseï¼ˆè¯¾ç¨‹ï¼‰

```prisma
model course {
  id             Int        @id @default(autoincrement())
  department_id  Int        // å¤–é”®å…³è”å­¦é™¢
  department     department @relation(fields: [department_id], references: [id], onDelete: Cascade)

  slug           String     // ä¸å­¦é™¢ç»„åˆå”¯ä¸€ï¼ŒURL å‹å¥½
  code           String?    @unique // è¯¾ç¨‹ä»£ç ï¼Œå¦‚ "CS2001"
  name           String     // è¯¾ç¨‹åç§°
  description    String?    // è¯¾ç¨‹æè¿°
  instructor_name String?   // æˆè¯¾æ•™å¸ˆå§“å
  cover_url      String?    // å°é¢å›¾ç‰‡
  tags           String[]   // æ ‡ç­¾æ•°ç»„

  // ç»Ÿè®¡å­—æ®µï¼ˆå®æ—¶æ›´æ–°ï¼‰
  resource_count Int        @default(0)  // èµ„æºæ•°é‡
  post_count     Int        @default(0)  // å¸–å­æ•°é‡
  heart_count    Int        @default(0)  // çº¢å¿ƒæ•°
  difficulty_avg Float      @default(0)  // å¹³å‡éš¾åº¦
  difficulty_votes Int      @default(0)  // æŠ•ç¥¨äººæ•°

  created        DateTime   @default(now())
  updated        DateTime   @updatedAt

  // å…³è”
  resources      resource[] // è¯¾ç¨‹èµ„æº
  posts          post[]     // ç»éªŒå¸–
  course_teacher course_teacher[] // æ•™å¸ˆ-è¯¾ç¨‹å…³è”
  comments       comment[]  // è¯¾ç¨‹è¯„è®º
  feedbacks      course_feedback[] // è¯¾ç¨‹åé¦ˆ

  @@unique([department_id, slug]) // ç»„åˆå”¯ä¸€ç´¢å¼•
  @@index([department_id, created]) // å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
}
```

**å¤åˆå”¯ä¸€çº¦æŸï¼š**

- `department_id + slug` å”¯ä¸€ï¼šç¡®ä¿åŒä¸€å­¦é™¢ä¸‹è¯¾ç¨‹ slug ä¸é‡å¤
- URL ç¤ºä¾‹ï¼š`/course/cs/signal-and-system`ï¼ˆè®¡ç®—æœºå­¦é™¢/ä¿¡å·ä¸ç³»ç»Ÿï¼‰

#### 3.2.3 Resourceï¼ˆè¯¾ç¨‹èµ„æºï¼‰

```prisma
model resource {
  id        Int            @id @default(autoincrement())
  course_id Int
  course    course         @relation(fields: [course_id], references: [id], onDelete: Cascade)

  title     String         // èµ„æºæ ‡é¢˜
  summary   String?        // èµ„æºæ‘˜è¦
  type      resource_type  // èµ„æºç±»å‹ï¼ˆenumï¼‰

  // ä»…å­˜å‚¨å¤–é“¾ï¼Œä¸å­˜å‚¨æ–‡ä»¶
  links     String[]       // å¤šä¸ªä¸‹è½½é“¾æ¥æ•°ç»„

  status    content_status @default(published) // å®¡æ ¸çŠ¶æ€
  visibility visibility     @default(public)   // å¯è§æ€§

  term      String?        // å­¦æœŸç­›é€‰ï¼Œå¦‚ "2024-Fall"
  teacher_id Int?
  teacher   teacher?       @relation(fields: [teacher_id], references: [id], onDelete: SetNull)

  // ä¸Šä¼ è€…
  author_id Int
  author    user           @relation("user_course_resource", fields: [author_id], references: [id], onDelete: Cascade)

  // ç»Ÿè®¡
  rating_avg   Float @default(0)
  rating_count Int   @default(0)
  download_count Int @default(0)
  click_count  Int   @default(0)

  created   DateTime @default(now())
  updated   DateTime @updatedAt

  ratings   resource_rating[]
  comments  comment[]
  interactions resource_interaction[]

  @@index([course_id, created])
  @@index([course_id, type, created])
}
```

**å…³é”®è®¾è®¡ï¼š**

- `links String[]`ï¼šå­˜å‚¨å¤šä¸ªå¤–é“¾ï¼Œä¾¿äºå¤šä¸ªé•œåƒ/ç½‘ç›˜é“¾æ¥
- `status pending`ï¼šèµ„æºå…ˆè¿›å…¥å¾…å®¡æ ¸çŠ¶æ€ï¼Œç®¡ç†å‘˜å®¡æ ¸åå‘å¸ƒ
- `author_id`ï¼šè®°å½•ä¸Šä¼ è€…ï¼Œç”¨äºç»Ÿè®¡è´¡çŒ®å€¼
- åˆ†ç±»ç´¢å¼•ï¼šæ ¹æ®è¯¾ç¨‹ã€ç±»å‹ã€åˆ›å»ºæ—¶é—´ä¼˜åŒ–æŸ¥è¯¢

#### 3.2.4 Commentï¼ˆè¯„è®ºï¼‰

```prisma
model comment {
  id        Int       @id @default(autoincrement())
  content   String    @db.VarChar(10007) // è¯„è®ºå†…å®¹ï¼Œæ”¯æŒ Markdown

  // å…³è”å®ä½“ï¼ˆä¸‰ç§ä¹‹ä¸€ï¼‰
  course_id   Int?
  course      course?   @relation(fields: [course_id], references: [id], onDelete: Cascade)

  resource_id Int?
  resource    resource? @relation(fields: [resource_id], references: [id], onDelete: Cascade)

  post_id     Int?
  post        post?     @relation(fields: [post_id], references: [id], onDelete: Cascade)

  // ä½œè€…
  author_id   Int?
  author      user?     @relation(fields: [author_id], references: [id], onDelete: SetNull)

  // åµŒå¥—å›å¤
  parent_id   Int?
  parent      comment?  @relation("comment_reply", fields: [parent_id], references: [id], onDelete: Cascade)
  reply       comment[] @relation("comment_reply")

  // ç‚¹èµ
  like_by course_comment_like[]

  created     DateTime @default(now())
  updated     DateTime @updatedAt

  @@index([course_id, created])
  @@index([resource_id, created])
  @@index([post_id, created])
}
```

**åµŒå¥—è¯„è®ºå®ç°ï¼š**

- `parent_id`ï¼šå¦‚æœå­˜åœ¨ï¼Œè¡¨ç¤ºæ˜¯å›å¤è¯„è®º
- `reply`ï¼šè¯¥è¯„è®ºçš„æ‰€æœ‰å­å›å¤
- é€šè¿‡é€’å½’æŸ¥è¯¢å®ç°æ— é™åµŒå¥—

#### 3.2.5 Course Feedbackï¼ˆè¯¾ç¨‹åé¦ˆï¼‰

```prisma
model course_feedback {
  id         Int      @id @default(autoincrement())
  course_id  Int
  course     course   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  user_id    Int
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  liked      Boolean  @default(false) // çº¢å¿ƒç‚¹èµ
  difficulty Int?     // éš¾åº¦è¯„åˆ† 1-5
  comment    String?  // å¯é€‰çŸ­è¯„

  created    DateTime @default(now())
  updated    DateTime @updatedAt

  @@unique([course_id, user_id]) // æ¯ç”¨æˆ·æ¯è¯¾ç¨‹åªèƒ½åé¦ˆä¸€æ¬¡
  @@index([course_id])
}
```

**èšåˆç»Ÿè®¡ï¼š**

- è¯¾ç¨‹ `heart_count`ï¼šæ‰€æœ‰ liked=true çš„æ•°é‡
- è¯¾ç¨‹ `difficulty_avg`ï¼š`difficulty` çš„å¹³å‡å€¼
- è¯¾ç¨‹ `difficulty_votes`ï¼šæŠ•ç¥¨äººæ•°

### 3.3 æ•°æ®è®¿é—®å±‚ï¼ˆPrismaï¼‰

**é…ç½®ï¼š** `prisma/index.ts`

```typescript
import { PrismaClient } from '@prisma/client'

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined
}

export const prisma = globalForPrisma.prisma ?? new PrismaClient()

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma
}
```

**ç”¨æ³•ç¤ºä¾‹ï¼š**

```typescript
// 1. ç®€å•æŸ¥è¯¢
const users = await prisma.user.findMany()

// 2. æ¡ä»¶æŸ¥è¯¢
const courses = await prisma.course.findMany({
  where: {
    department: { slug: 'cs' }, // åµŒå¥—æ¡ä»¶
    resource_count: { gt: 0 } // å¤§äº
  }
})

// 3. åˆ†é¡µæŸ¥è¯¢
const [total, list] = await Promise.all([
  prisma.course.count({ where }),
  prisma.course.findMany({
    where,
    orderBy: { created: 'desc' }, // å€’åº
    skip: (page - 1) * pageSize,
    take: pageSize,
    include: { department: true } // å…³è”æŸ¥è¯¢
  })
])

// 4. æ’å…¥æ•°æ®
const newCourse = await prisma.course.create({
  data: {
    name: 'æ–°è¯¾ç¨‹',
    slug: 'new-course',
    department_id: deptId
  }
})

// 5. æ›´æ–°æ•°æ®
await prisma.course.update({
  where: { id: courseId },
  data: { resource_count: { increment: 1 } } // åŸå­è‡ªå¢
})

// 6. åˆ é™¤æ•°æ®
await prisma.course.delete({
  where: { id: courseId }
})
```

**å…³é”®å‘½ä»¤ï¼š**

```bash
# ç”Ÿæˆ Prisma Client
pnpm prisma:generate

# åŒæ­¥æ•°æ®åº“ schema
pnpm prisma:push

# æŸ¥çœ‹æ•°æ®åº“
pnpm prisma studio
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½æµç¨‹

### 4.1 ç”¨æˆ·è®¤è¯æµç¨‹

#### ç™»å½•æµç¨‹

1. **å‰ç«¯**ï¼šç”¨æˆ·è¾“å…¥è´¦å·/å¯†ç ï¼Œ`components/login/Login.tsx`
2. **API**ï¼š`app/api/auth/login/route.ts` éªŒè¯
3. **å¯†ç éªŒè¯**ï¼š`app/api/utils/algorithm.ts` ä½¿ç”¨ bcrypt
4. **JWT ç”Ÿæˆ**ï¼š`app/api/utils/jwt.ts` ç”Ÿæˆ Token
5. **Cookie è®¾ç½®**ï¼šè®¾ç½® HttpOnly Cookieï¼ˆ`toki-nwpushare-access-token`ï¼‰
6. **è¿”å›**ï¼šç”¨æˆ·ä¿¡æ¯ï¼ˆè§’è‰²ã€æƒé™ç­‰ï¼‰

```typescript
// ç™»å½•æ ¸å¿ƒé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
export const POST = async (req: NextRequest) => {
  // 1. è§£æè¾“å…¥
  const input = await kunParsePostBody(req, loginSchema)

  // 2. æŸ¥æ‰¾ç”¨æˆ·
  const user = await prisma.user.findFirst({
    where: {
      OR: [
        { email: { equals: normalizedName, mode: 'insensitive' } },
        { name: { equals: normalizedName, mode: 'insensitive' } }
      ]
    }
  })

  // 3. éªŒè¯å¯†ç 
  const isPasswordValid = await verifyPassword(password, user.password)

  // 4. ç”Ÿæˆ JWT
  const token = await generateKunToken(user.id, user.name, user.role, '30d')

  // 5. è®¾ç½® Cookie
  cookie.set('toki-nwpushare-access-token', token, {
    httpOnly: true,
    sameSite: 'strict',
    maxAge: 30 * 24 * 60 * 60 * 1000
  })

  return NextResponse.json(userInfo)
}
```

#### æƒé™æ£€æŸ¥

```typescript
// middleware/_verifyHeaderCookie.ts
export const verifyHeaderCookie = async (req: Request) => {
  const cookie = await cookies()
  const token = cookie.get('toki-nwpushare-access-token')?.value

  if (!token) return null

  try {
    const payload = await verifyKunToken(token)
    return payload
  } catch {
    return null
  }
}
```

**è§’è‰²ç³»ç»Ÿï¼š**

- 1ï¼šæ™®é€šç”¨æˆ·
- 2ï¼šå‘å¸ƒè€…
- 3ï¼šç®¡ç†å‘˜
- 4ï¼šè¶…çº§ç®¡ç†å‘˜

### 4.2 è¯¾ç¨‹èµ„æºä¸Šä¼ æµç¨‹

#### æµç¨‹å›¾

```
ç”¨æˆ·é€‰æ‹©å­¦é™¢ â†’ é€‰æ‹©è¯¾ç¨‹ â†’ å¡«å†™èµ„æºä¿¡æ¯ â†’ æäº¤ â†’
API éªŒè¯ â†’ è‡ªåŠ¨åˆ›å»ºç¼ºå¤±è¯¾ç¨‹ â†’ èµ„æºçŠ¶æ€=pending â†’ ç­‰å¾…å®¡æ ¸
```

#### å‰ç«¯å®ç°

**ç»„ä»¶ï¼š** `components/course/upload/UploadResourceForm.tsx`

```typescript
const onSubmit = async (data) => {
  // 1. è¡¨å•éªŒè¯ï¼ˆZodï¼‰
  const validated = courseResourceCreateSchema.parse(data)

  // 2. æäº¤ API
  const res = await kunFetchPost(`/course/${dept}/${slug}/resources`, validated)

  // 3. è·³è½¬æˆ–æç¤º
  router.push(`/course/${dept}/${slug}`)
}
```

#### åç«¯å®ç°

**APIï¼š** `app/api/course/[dept]/[slug]/resources/route.ts`

```typescript
export const POST = async (req: NextRequest, { params }) => {
  // 1. éªŒè¯è¾“å…¥
  const input = await kunParsePostBody(req, courseResourceCreateSchema)

  // 2. æ£€æŸ¥æˆ–åˆ›å»ºå­¦é™¢
  let department = await prisma.department.upsert({
    where: { slug: dept },
    update: {},
    create: { slug: dept, name: dept }
  })

  // 3. æ£€æŸ¥æˆ–åˆ›å»ºè¯¾ç¨‹
  let course = await prisma.course.findUnique({
    where: { department_id_slug: { department_id: department.id, slug } }
  })

  if (!course) {
    course = await prisma.course.create({
      data: {
        department_id: department.id,
        slug,
        name: input.courseName || input.title
      }
    })
  }

  // 4. åˆ›å»ºèµ„æº
  const resource = await prisma.resource.create({
    data: {
      course_id: course.id,
      title: input.title,
      type: input.type,
      links: input.links,
      term: input.term,
      author_id: payload.uid,
      status: 'pending' // å¾…å®¡æ ¸çŠ¶æ€
    }
  })

  // 5. æ›´æ–°è¯¾ç¨‹èµ„æºç»Ÿè®¡
  await prisma.course.update({
    where: { id: course.id },
    data: { resource_count: { increment: 1 } }
  })

  return NextResponse.json(resource)
}
```

**å…³é”®è®¾è®¡ï¼š**

- `upsert`ï¼šè‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„å­¦é™¢/è¯¾ç¨‹
- `pending` çŠ¶æ€ï¼šé˜²æ­¢ç«‹å³å‘å¸ƒï¼Œéœ€ç®¡ç†å‘˜å®¡æ ¸
- åŸå­è‡ªå¢ï¼š`resource_count: { increment: 1 }` é¿å…å¹¶å‘é—®é¢˜

### 4.3 è¯„è®ºç³»ç»Ÿæµç¨‹

#### è¯„è®ºå‘å¸ƒ

1. **ç”¨æˆ·è¾“å…¥**ï¼šå¯Œæ–‡æœ¬/ Markdown å†…å®¹
2. **å‰ç«¯éªŒè¯**ï¼šä½¿ç”¨ `validations/course.ts` çš„ `courseCommentCreateSchema`
3. **API ä¿å­˜**ï¼šå­˜å‚¨åˆ° `comment` è¡¨ï¼Œè®¾ç½® `course_id`
4. **Markdown æ¸²æŸ“**ï¼šåç«¯ `markdownToHtml` è½¬æ¢ä¸º HTML
5. **è¿”å›å‰ç«¯**ï¼šæ¸²æŸ“è¯„è®ºæ ‘

#### åµŒå¥—è¯„è®º

**æ•°æ®ç»“æ„ï¼š**

```
è¯„è®º 1 (parent_id: null)
â”œâ”€ è¯„è®º 2 (parent_id: 1)
â”‚  â””â”€ è¯„è®º 3 (parent_id: 2)
â””â”€ è¯„è®º 4 (parent_id: 1)
```

**API å“åº”æ‰å¹³åŒ– + å‰ç«¯åµŒå¥—ï¼š**

```typescript
// app/api/course/[dept]/[slug]/comment/_helpers.ts
export const nestCourseComments = (
  comments: PatchComment[]
): PatchComment[] => {
  const map = new Map<number, PatchComment>()
  const roots: PatchComment[] = []

  comments.forEach((c) => map.set(c.id, { ...c, reply: [] }))

  map.forEach((comment) => {
    if (comment.parentId) {
      const parent = map.get(comment.parentId)
      parent?.reply.push(comment)
    } else {
      roots.push(comment)
    }
  })

  return roots
}
```

#### ç‚¹èµæµç¨‹

```typescript
// app/api/course/[dept]/[slug]/comment/like/route.ts
export const PUT = async (req: NextRequest) => {
  const payload = await verifyHeaderCookie(req)
  const { commentId } = await kunParsePutBody(req, commentIdSchema)

  const existing = await prisma.course_comment_like.findUnique({
    where: {
      user_id_comment_id: { user_id: payload.uid, comment_id: commentId }
    }
  })

  if (existing) {
    // å·²ç‚¹èµ â†’ å–æ¶ˆç‚¹èµ
    await prisma.course_comment_like.delete({
      where: { id: existing.id }
    })
  } else {
    // æœªç‚¹èµ â†’ æ·»åŠ ç‚¹èµ
    await prisma.course_comment_like.create({
      data: { user_id: payload.uid, comment_id: commentId }
    })
  }

  return NextResponse.json({ success: true })
}
```

### 4.4 è¯¾ç¨‹åé¦ˆæµç¨‹

#### æäº¤åé¦ˆ

```typescript
// app/api/course/[dept]/[slug]/rating/route.ts
export const POST = async (req: NextRequest, { params }) => {
  const input = await kunParsePostBody(req, courseFeedbackCreateSchema)
  const payload = await verifyHeaderCookie(req)

  // upsertï¼šä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™æ›´æ–°
  const feedback = await prisma.course_feedback.upsert({
    where: {
      course_id_user_id: { course_id: course.id, user_id: payload.uid }
    },
    update: {
      liked: input.liked,
      difficulty: input.difficulty,
      comment: input.comment
    },
    create: {
      course_id: course.id,
      user_id: payload.uid,
      liked: input.liked,
      difficulty: input.difficulty,
      comment: input.comment
    }
  })

  // é‡æ–°èšåˆç»Ÿè®¡
  const [heartCount, avg, votes] = await Promise.all([
    prisma.course_feedback.count({
      where: { course_id: course.id, liked: true }
    }),
    prisma.course_feedback.aggregate({
      where: { course_id: course.id, difficulty: { not: null } },
      _avg: { difficulty: true },
      _count: { difficulty: true }
    })
  ])

  // æ›´æ–°è¯¾ç¨‹ç»Ÿè®¡å­—æ®µ
  await prisma.course.update({
    where: { id: course.id },
    data: {
      heart_count: heartCount,
      difficulty_avg: avg._avg.difficulty || 0,
      difficulty_votes: avg._count.difficulty
    }
  })

  return NextResponse.json(feedback)
}
```

**æ ¸å¿ƒè®¾è®¡ï¼š**

- `upsert`ï¼šæ¯ç”¨æˆ·æ¯è¯¾ç¨‹åªèƒ½åé¦ˆä¸€æ¬¡
- å®æ—¶èšåˆï¼šåé¦ˆåç«‹å³æ›´æ–°è¯¾ç¨‹ç»Ÿè®¡å­—æ®µ
- å¯é€‰å­—æ®µï¼š`difficulty` å’Œ `comment` å¯ä¸ºç©º

---

## 5. å½“å‰å­˜åœ¨çš„é—®é¢˜

### 5.1 æ¶æ„é—®é¢˜

#### é—®é¢˜ 1ï¼šå“ç‰Œä¸å‘½åæ··ä¹±

**ç°è±¡ï¼š**

- ä»£ç ä¸­å¤§é‡æ®‹ç•™ TouchGal å‘½åï¼ˆCookie åç§°ã€å˜é‡åã€æ³¨é‡Šï¼‰
- æ–‡ä»¶åã€ç»„ä»¶åä»ä½¿ç”¨ `patch`ã€`galgame` ç­‰å†å²æœ¯è¯­
- Logoã€ä¸»é¢˜è‰²æœªæ›´æ–°ä¸ºå­¦ä¹ å¹³å°é£æ ¼

**å½±å“ï¼š**

- æ–°æ‰‹éš¾ä»¥ç†è§£ä»£ç æ„å›¾
- ç»´æŠ¤å›°éš¾
- ç”¨æˆ·è®¤çŸ¥æ··ä¹±

**ç¤ºä¾‹ï¼š**

```typescript
// Cookie åç§°ä»æœ‰å†å²ç—•è¿¹
cookie.set('toki-nwpushare-access-token', token, { ... })
cookie.set('kun-galgame-patch-moe-2fa-token', tempToken, { ... })

// ç»„ä»¶å¯¼å…¥è·¯å¾„
import type { PatchComment } from '~/types/api/patch'
```

#### é—®é¢˜ 2ï¼šå½’æ¡£ä¸å½»åº•

**ç°è±¡ï¼š**

- TouchGal ç›¸å…³ä»£ç ä»åœ¨ `app/api/`ã€`components/` ä¸­è¿è¡Œ
- `archive/touchgal/` å½’æ¡£äº†éƒ¨åˆ†æ–‡ä»¶ï¼Œä½†æœªå®Œå…¨éš”ç¦»
- è·¯ç”±ä»åœ¨ä½¿ç”¨æ—§é€»è¾‘ï¼Œå¦‚ `/api/patch/*`ã€`/api/galgame/*`

**å½±å“ï¼š**

- ä»£ç ä½“ç§¯è†¨èƒ€
- ç¼–è¯‘æ—¶é—´å¢åŠ 
- æ–°æ‰‹éš¾ä»¥åŒºåˆ†æ–°æ—§åŠŸèƒ½

#### é—®é¢˜ 3ï¼šæ•°æ®åº“ Schema åˆ†æ•£

**ç°è±¡ï¼š**

- Prisma schema æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼ˆ`course.prisma`ã€`user.prisma` ç­‰ï¼‰
- ä¸»å…¥å£ `schema.prisma` å¯¼å…¥æ‰€æœ‰æ–‡ä»¶
- éƒ¨åˆ†å†å²æ¨¡å‹ä»æ´»è·ƒï¼Œæœªå®Œå…¨è¿ç§»åˆ° `archive/`

**å½±å“ï¼š**

- æŸ¥è¯¢æ¨¡å‹æ—¶éœ€è·¨æ–‡ä»¶æŸ¥çœ‹
- ç±»å‹ç”Ÿæˆå¯èƒ½ä¸ä¸€è‡´

### 5.2 åŠŸèƒ½é—®é¢˜

#### é—®é¢˜ 4ï¼šè¯¾ç¨‹ç´¢å¼•é¡µæœªå®ç°

**ç°è±¡ï¼š**

- `/course` é¡µé¢å­˜åœ¨ä½†åŠŸèƒ½ä¸å®Œæ•´
- æ— æ³•æŒ‰å­¦é™¢ç­›é€‰è¯¾ç¨‹
- æœç´¢åŠŸèƒ½ä¾èµ–æ—§é€»è¾‘

**å½±å“ï¼š**

- ç”¨æˆ·æ— æ³•æµè§ˆæ‰€æœ‰è¯¾ç¨‹
- å¯¼èˆªèœå•å¤±æ•ˆ

#### é—®é¢˜ 5ï¼šå­¦é™¢è¯¦æƒ…é¡µæœªå®ç°

**ç°è±¡ï¼š**

- `/department/[slug]` é¡µé¢ä¸å­˜åœ¨
- æ— æ³•æŸ¥çœ‹å­¦é™¢ä¸‹çš„è¯¾ç¨‹ã€æ•™å¸ˆã€èµ„æºç»Ÿè®¡

**å½±å“ï¼š**

- ç¼ºå°‘å­¦é™¢å±‚çº§å¯¼èˆª
- ä¿¡æ¯æ¶æ„ä¸å®Œæ•´

#### é—®é¢˜ 6ï¼šèµ„æºå®¡æ ¸æµç¨‹ä¸å®Œæ•´

**ç°è±¡ï¼š**

- API æ”¯æŒ `pending` çŠ¶æ€
- ä½†ç¼ºå°‘ç®¡ç†å‘˜å®¡æ ¸é¡µé¢
- èµ„æºå‘å¸ƒåæ— æ³•ä¿®æ”¹çŠ¶æ€

**å½±å“ï¼š**

- ç®¡ç†å‘˜æ— æ³•ç®¡ç†å†…å®¹
- åƒåœ¾å†…å®¹æ— æ³•åŠæ—¶æ¸…ç†

#### é—®é¢˜ 7ï¼šç»éªŒå¸–å­åŠŸèƒ½ç¼ºå¤±

**ç°è±¡ï¼š**

- `post` æ¨¡å‹å·²å­˜åœ¨
- ä½†å‰ç«¯æœªå®ç°ç»éªŒå¸–å‘å¸ƒ/æµè§ˆ
- "è®¨è®ºç‰ˆ" Tab ç›®å‰åªæ˜¾ç¤ºè¯„è®º

**å½±å“ï¼š**

- æ ¸å¿ƒåŠŸèƒ½ç¼ºå¤±
- ç”¨æˆ·æ— æ³•åˆ†äº«é•¿ç¯‡ç»éªŒ

#### é—®é¢˜ 8ï¼šæœç´¢åŠŸèƒ½è½å

**ç°è±¡ï¼š**

- æœç´¢ä»ä½¿ç”¨ TouchGal çš„ `/api/search/tag`
- æœªé’ˆå¯¹è¯¾ç¨‹/èµ„æºä¼˜åŒ–
- æ— æ³•è·¨è¡¨æœç´¢ï¼ˆè¯¾ç¨‹ + èµ„æºï¼‰

**å½±å“ï¼š**

- æœç´¢ç»“æœä¸å‡†ç¡®
- æ€§èƒ½ä¸ä½³

### 5.3 å®‰å…¨é—®é¢˜

#### é—®é¢˜ 9ï¼šç™»å½•å®‰å…¨é™çº§

**ç°è±¡ï¼š**

- éªŒè¯ç ï¼ˆCaptchaï¼‰è¢«ä¸´æ—¶å…³é—­ï¼š`const res = true`
- å¯†ç æ ¼å¼æ ¡éªŒè¢«ç¦ç”¨
- å¯èƒ½å—åˆ°æš´åŠ›ç ´è§£æ”»å‡»

**ä»£ç ï¼š**

```typescript
// app/api/auth/login/route.ts
const { name, password, captcha } = input
const res = true // æš‚æ—¶å…³é—­äººæœºéªŒè¯
```

**å½±å“ï¼š**

- å®‰å…¨é£é™©å¢åŠ 
- éœ€åœ¨æ¢å¤æ—¶é‡æ–°å¯ç”¨

#### é—®é¢˜ 10ï¼šèº«ä»½è®¤è¯æ–¹æ¡ˆé™ˆæ—§

**ç°è±¡ï¼š**

- ä½¿ç”¨è‡ªç ” JWT + Redis
- æœªæ¥å…¥ BetterAuth ç­‰ç°ä»£åŒ–æ–¹æ¡ˆ
- Cookie ç®¡ç†ã€ç»­æœŸé€»è¾‘å¤æ‚

**å½±å“ï¼š**

- ç»´æŠ¤æˆæœ¬é«˜
- å®‰å…¨æœ€ä½³å®è·µç¼ºå¤±

### 5.4 æ€§èƒ½é—®é¢˜

#### é—®é¢˜ 11ï¼šAPI å“åº”æœªä¼˜åŒ–

**ç°è±¡ï¼š**

- éƒ¨åˆ†æŸ¥è¯¢æœªä½¿ç”¨ç´¢å¼•ï¼ˆå°½ç®¡ Prisma å·²å®šä¹‰ï¼‰
- N+1 æŸ¥è¯¢é—®é¢˜æœªè§£å†³ï¼ˆå¦‚è·å–è¯¾ç¨‹ + æ•™å¸ˆï¼‰
- æœªä½¿ç”¨æ•°æ®ç¼“å­˜

**ç¤ºä¾‹ï¼š**

```typescript
// N+1 é—®é¢˜ç¤ºä¾‹ï¼ˆåº”è¯¥é¿å…ï¼‰
const courses = await prisma.course.findMany()
courses.forEach(async (course) => {
  const teachers = await prisma.course_teacher.findMany({
    where: { course_id: course.id }
  })
})

// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ include
const courses = await prisma.course.findMany({
  include: { course_teacher: { include: { teacher: true } } }
})
```

#### é—®é¢˜ 12ï¼šé™æ€èµ„æºæœªä¼˜åŒ–

**ç°è±¡ï¼š**

- å›¾ç‰‡æœªè‡ªåŠ¨å‹ç¼©
- æ—  CDN é›†æˆ
- æœªä½¿ç”¨ Next.js Image ä¼˜åŒ–

### 5.5 ç”¨æˆ·ä½“éªŒé—®é¢˜

#### é—®é¢˜ 13ï¼šå¯¼èˆªä¸å“ç‰Œä¸ä¸€è‡´

**ç°è±¡ï¼š**

- TopBar èœå•å·²æ›´æ–°ä¸ºå­¦ä¹ å¹³å°
- ä½† Logoã€ä¸»é¢˜è‰²ã€Hero å›¾ä»ä¿ç•™ TouchGal é£æ ¼

**å½±å“ï¼š**

- è§†è§‰è®¤çŸ¥å†²çª
- ç”¨æˆ·å›°æƒ‘

#### é—®é¢˜ 14ï¼šé”™è¯¯å¤„ç†ä¸å‹å¥½

**ç°è±¡ï¼š**

- API é”™è¯¯è¿”å›åŸå§‹å­—ç¬¦ä¸²
- å‰ç«¯æœªç»Ÿä¸€é”™è¯¯æç¤ºç»„ä»¶
- ç¼ºå°‘åŠ è½½çŠ¶æ€ï¼ˆLoadingï¼‰

**ç¤ºä¾‹ï¼š**

```typescript
// API ç›´æ¥è¿”å›å­—ç¬¦ä¸²
return NextResponse.json('ç”¨æˆ·æœªç™»å½•')
return NextResponse.json('è¯„è®ºä¸å­˜åœ¨')

// å‰ç«¯éœ€è¦æ‰‹åŠ¨å¤„ç†
if (typeof res === 'string') {
  toast.error(res)
}
```

---

## 6. å®Œæ•´TODOæ¸…å•

### 6.1 ç´§æ€¥ä¿®å¤ï¼ˆHigh Priorityï¼‰

#### TODO-1ï¼šæ¸…ç† TouchGal é—ç•™ä»£ç 

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] é‡å‘½åæ‰€æœ‰ Cookie åç§°
  - [ ] æ›¿æ¢ç±»å‹å®šä¹‰ `PatchComment` â†’ `CourseComment`
  - [ ] æ›´æ–°å˜é‡åã€å‡½æ•°åã€æ³¨é‡Š
  - [ ] åˆ é™¤ `/api/patch/*` è·¯ç”±ï¼ˆå¦‚ä¸éœ€è¦ï¼‰
  - [ ] åˆ é™¤ `/api/galgame/*` è·¯ç”±ï¼ˆå¦‚ä¸éœ€è¦ï¼‰
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/api/auth/login/route.ts`
  - `types/api/patch.ts`
  - æ‰€æœ‰ API è·¯ç”±æ–‡ä»¶
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æœç´¢ä»£ç æ—  "patch"ã€"galgame" å…³é”®è¯ï¼ˆå½’æ¡£ç›®å½•é™¤å¤–ï¼‰
  - Cookie åç§°ç»Ÿä¸€ä¸ºå­¦ä¹ å¹³å°ç›¸å…³

#### TODO-2ï¼šæ¢å¤ç™»å½•å®‰å…¨æªæ–½

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š0.5 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] é‡æ–°å¯ç”¨éªŒè¯ç éªŒè¯
  - [ ] é‡æ–°å¯ç”¨å¯†ç æ ¼å¼æ ¡éªŒ
  - [ ] æ·»åŠ ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶
  - [ ] æµ‹è¯•ç™»å½•æµç¨‹
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/api/auth/login/route.ts`
  - `app/api/utils/verifyKunCaptcha.ts`
  - `validations/auth.ts`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æœªç™»å½•ç”¨æˆ·æ— æ³•è®¿é—®éœ€è®¤è¯çš„ API
  - éªŒè¯ç é”™è¯¯æ—¶ç™»å½•å¤±è´¥
  - å¯†ç æ ¼å¼ä¸ç¬¦åˆè¦æ±‚æ—¶ç™»å½•å¤±è´¥

#### TODO-3ï¼šä¿®å¤è¯¾ç¨‹ç´¢å¼•é¡µ

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] å®Œå–„ `app/course/page.tsx` é¡µé¢
  - [ ] å®ç°æŒ‰å­¦é™¢ç­›é€‰
  - [ ] å®ç°å…³é”®è¯æœç´¢
  - [ ] å®ç°åˆ†é¡µ
  - [ ] å¤ç”¨ `components/home/course/CourseCard.tsx`
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/course/page.tsx`
  - `components/home/course/CourseCard.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - è®¿é—® `/course` æ˜¾ç¤ºè¯¾ç¨‹åˆ—è¡¨
  - å¯ä»¥æŒ‰å­¦é™¢ç­›é€‰
  - å¯ä»¥æœç´¢è¯¾ç¨‹
  - ç‚¹å‡»è¯¾ç¨‹å¡ç‰‡è·³è½¬åˆ°è¯¦æƒ…é¡µ

### 6.2 æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆHigh Priorityï¼‰

#### TODO-4ï¼šå®ç°å­¦é™¢è¯¦æƒ…é¡µ

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š2 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] åˆ›å»º `app/department/[slug]/page.tsx`
  - [ ] å®ç°å­¦é™¢ä¿¡æ¯å±•ç¤º
  - [ ] åˆ—å‡ºå­¦é™¢ä¸‹çš„è¯¾ç¨‹
  - [ ] ç»Ÿè®¡æ•™å¸ˆæ•°é‡ã€èµ„æºæ•°é‡
  - [ ] åˆ›å»º `components/department/DepartmentHeader.tsx`
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/department/[slug]/page.tsx`
  - `components/department/DepartmentHeader.tsx`
  - `app/api/department/list/route.ts`ï¼ˆéœ€æ‰©å±•ï¼‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - è®¿é—® `/department/cs` æ˜¾ç¤ºè®¡ç®—æœºå­¦é™¢ä¿¡æ¯
  - æ˜¾ç¤ºè¯¥å­¦é™¢æ‰€æœ‰è¯¾ç¨‹åˆ—è¡¨
  - æ˜¾ç¤ºè¯¾ç¨‹ã€æ•™å¸ˆã€èµ„æºç»Ÿè®¡

#### TODO-5ï¼šå®ç°ç»éªŒå¸–åŠŸèƒ½

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š3 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] å®Œå–„ `app/api/course/[dept]/[slug]/posts/route.ts`
  - [ ] åˆ›å»ºå‘å¸ƒé¡µé¢ `app/course/[dept]/[slug]/posts/new/page.tsx`
  - [ ] å¤ç”¨ Milkdown ç¼–è¾‘å™¨
  - [ ] å®ç°å¸–å­åˆ—è¡¨ã€è¯¦æƒ…ã€ç¼–è¾‘ã€åˆ é™¤
  - [ ] æ›´æ–° "è®¨è®ºç‰ˆ" Tabï¼ˆåˆå¹¶è¯„è®º + å¸–å­ï¼‰
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/api/course/[dept]/[slug]/posts/route.ts`
  - `app/course/[dept]/[slug]/posts/new/page.tsx`
  - `components/course/PostList.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - å¯ä»¥åœ¨è¯¾ç¨‹ä¸‹å‘å¸ƒç»éªŒå¸–
  - å¸–å­æ”¯æŒ Markdown
  - å¸–å­å¯ä»¥è¯„è®ºã€ç‚¹èµ
  - è®¨è®ºç‰ˆ Tab åŒæ—¶æ˜¾ç¤ºè¯„è®ºå’Œå¸–å­

#### TODO-6ï¼šå®ç°èµ„æºå®¡æ ¸åå°

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š2 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] åˆ›å»º `app/admin/resources/page.tsx`
  - [ ] åˆ—å‡ºæ‰€æœ‰ `status=pending` çš„èµ„æº
  - [ ] æä¾› "é€šè¿‡"/"æ‹’ç»" æ“ä½œ
  - [ ] æ›´æ–°èµ„æºçŠ¶æ€
  - [ ] å‘é€é€šçŸ¥ç»™ä¸Šä¼ è€…
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/admin/resources/page.tsx`
  - `app/api/admin/resource/route.ts`ï¼ˆéœ€æ‰©å±•ï¼‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°å¾…å®¡æ ¸èµ„æºåˆ—è¡¨
  - å¯ä»¥æ‰¹å‡†æˆ–æ‹’ç»èµ„æº
  - çŠ¶æ€å˜æ›´åèµ„æºè®¡æ•°æ­£ç¡®æ›´æ–°

### 6.3 åŠŸèƒ½å¢å¼ºï¼ˆMedium Priorityï¼‰

#### TODO-7ï¼šä¼˜åŒ–æœç´¢åŠŸèƒ½

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š2 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] åˆ›å»º `app/api/search/route.ts`
  - [ ] å®ç°è¯¾ç¨‹ + èµ„æºè”åˆæœç´¢
  - [ ] æ”¯æŒæ ‡ç­¾æœç´¢
  - [ ] æ·»åŠ æœç´¢å»ºè®®ï¼ˆautocompleteï¼‰
  - [ ] ä¼˜åŒ–æœç´¢æ€§èƒ½
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/api/search/route.ts`
  - `app/search/page.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æœç´¢ "çº¿æ€§ä»£æ•°" è¿”å›ç›¸å…³è¯¾ç¨‹å’Œèµ„æº
  - æœç´¢å“åº”æ—¶é—´ < 200ms
  - æ”¯æŒå¤šå…³é”®è¯æœç´¢

#### TODO-8ï¼šå®ç°ç”¨æˆ·ä¸­å¿ƒï¼ˆè¯¾ç¨‹ç‰ˆï¼‰

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š2 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] é‡å†™ `app/user/[id]/page.tsx`
  - [ ] æ˜¾ç¤ºç”¨æˆ·ä¸Šä¼ çš„èµ„æº
  - [ ] æ˜¾ç¤ºç”¨æˆ·å‚ä¸çš„è¯„è®º
  - [ ] æ˜¾ç¤ºç”¨æˆ·æäº¤çš„åé¦ˆ
  - [ ] åˆ é™¤ TouchGal ç›¸å…³æ˜¾ç¤º
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/user/[id]/page.tsx`
  - `components/user/Activity.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„è´¡çŒ®å†å²
  - ä¸æ˜¾ç¤ºä¸è¯¾ç¨‹æ— å…³çš„å†…å®¹

#### TODO-9ï¼šæ·»åŠ èµ„æºäº’åŠ¨ç»Ÿè®¡

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] å®Œå–„ `resource_interaction` è¡¨ä½¿ç”¨
  - [ ] è®°å½•ç‚¹å‡»/ä¸‹è½½äº‹ä»¶
  - [ ] å®ç°æ’è¡Œæ¦œï¼ˆæœ€å—æ¬¢è¿èµ„æºï¼‰
  - [ ] æ›´æ–°é¦–é¡µ "æœ€æ–°èµ„æº" Section
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/api/course/[dept]/[slug]/resources/route.ts`
  - `components/home/resource/HomeLatestResourceSection.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - ç‚¹å‡»èµ„æºé“¾æ¥è®°å½•åˆ°æ•°æ®åº“
  - é¦–é¡µæ˜¾ç¤ºçƒ­é—¨èµ„æº
  - èµ„æºå¡ç‰‡æ˜¾ç¤ºç‚¹å‡»/ä¸‹è½½æ•°

### 6.4 ä½“éªŒä¼˜åŒ–ï¼ˆMedium Priorityï¼‰

#### TODO-10ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] åˆ›å»ºç»Ÿä¸€ API é”™è¯¯å“åº”æ ¼å¼
  - [ ] åˆ›å»ºå…¨å±€é”™è¯¯è¾¹ç•Œç»„ä»¶
  - [ ] æ·»åŠ åŠ è½½çŠ¶æ€ç»„ä»¶
  - [ ] ç¾åŒ– 404/500 é¡µé¢
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `app/api/utils/response.ts`
  - `components/error/ErrorComponent.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æ‰€æœ‰ API è¿”å›ç»Ÿä¸€æ ¼å¼ `{ success, data/error }`
  - ç½‘ç»œé”™è¯¯æ˜¾ç¤ºå‹å¥½æç¤º
  - åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å±

#### TODO-11ï¼šä¼˜åŒ–å›¾ç‰‡ä¸é™æ€èµ„æº

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] é›†æˆ Next.js Image ä¼˜åŒ–
  - [ ] é…ç½® CDNï¼ˆå¦‚ Cloudinaryï¼‰
  - [ ] æ·»åŠ å›¾ç‰‡å‹ç¼©
  - [ ] æ›´æ–°è¯¾ç¨‹å°é¢é»˜è®¤å›¾
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `next.config.js`
  - `components/course/Header.tsx`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - å›¾ç‰‡è‡ªåŠ¨å‹ç¼©å’Œä¼˜åŒ–
  - ä¸åŒå±å¹•å°ºå¯¸åŠ è½½ä¸åŒåˆ†è¾¨ç‡
  - é¡µé¢åŠ è½½é€Ÿåº¦æå‡

#### TODO-12ï¼šå“ç‰Œè§†è§‰æ›´æ–°

- **çŠ¶æ€**ï¼šğŸ”´ æœªå¼€å§‹
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] è®¾è®¡æ–°çš„ Logo
  - [ ] æ›´æ–°ä¸»é¢˜è‰²
  - [ ] æ›´æ–° Hero å›¾
  - [ ] æ›´æ–° Favicon
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `components/kun/top-bar/Brand.tsx`
  - `components/home/hero/HomeHero.tsx`
  - `public/favicon.ico`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - è§†è§‰é£æ ¼ç»Ÿä¸€ä¸ºå­¦ä¹ å¹³å°
  - ç”¨æˆ·èƒ½å¿«é€Ÿè¯†åˆ«å“ç‰Œ

### 6.5 æ¶æ„ä¼˜åŒ–ï¼ˆLow Priorityï¼‰

#### TODO-13ï¼šè¿ç§»åˆ° BetterAuth

- **çŠ¶æ€**ï¼šğŸŸ¡ è®¡åˆ’ä¸­
- **é¢„ä¼°æ—¶é—´**ï¼š5 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] ç ”ç©¶ BetterAuth é›†æˆæ–¹æ¡ˆ
  - [ ] é…ç½® OAuth æä¾›å•†ï¼ˆGoogleã€GitHub ç­‰ï¼‰
  - [ ] è¿ç§»ç°æœ‰ç”¨æˆ·æ•°æ®
  - [ ] åˆ é™¤è‡ªç ” JWT é€»è¾‘
  - [ ] æ›´æ–°æ‰€æœ‰è®¤è¯ç›¸å…³ä»£ç 
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - æ‰€æœ‰è®¤è¯ API
  - `middleware/_verifyHeaderCookie.ts`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æ”¯æŒ OAuth ç™»å½•
  - ä¼šè¯ç®¡ç†æ›´å®‰å…¨
  - ä»£ç é‡å‡å°‘

#### TODO-14ï¼šå¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•

- **çŠ¶æ€**ï¼šğŸŸ¡ è®¡åˆ’ä¸­
- **é¢„ä¼°æ—¶é—´**ï¼š3 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] é…ç½® Jest + Testing Library
  - [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆAPIã€ç»„ä»¶ï¼‰
  - [ ] ç¼–å†™é›†æˆæµ‹è¯•ï¼ˆç”¨æˆ·æµç¨‹ï¼‰
  - [ ] é…ç½® CI/CD è‡ªåŠ¨æµ‹è¯•
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `__tests__/` ç›®å½•
  - `.github/workflows/test.yml`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æ ¸å¿ƒåŠŸèƒ½æœ‰æµ‹è¯•è¦†ç›–
  - CI/CD è‡ªåŠ¨è¿è¡Œæµ‹è¯•
  - å›å½’é—®é¢˜å‡å°‘

#### TODO-15ï¼šæ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§

- **çŠ¶æ€**ï¼šğŸŸ¡ è®¡åˆ’ä¸­
- **é¢„ä¼°æ—¶é—´**ï¼š2 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] æ·»åŠ æ€§èƒ½ç›‘æ§ï¼ˆSentryã€LogRocketï¼‰
  - [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆæ·»åŠ ç¼ºå¤±ç´¢å¼•ï¼‰
  - [ ] å®ç° Redis ç¼“å­˜ï¼ˆè¯¾ç¨‹åˆ—è¡¨ã€è¯¦æƒ…ï¼‰
  - [ ] æ·»åŠ å®æ—¶é€šçŸ¥ï¼ˆWebSocketï¼‰
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `lib/monitoring.ts`
  - `app/api/utils/cache.ts`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - API å¹³å‡å“åº”æ—¶é—´ < 100ms
  - é¡µé¢é¦–å±åŠ è½½æ—¶é—´ < 2s
  - èƒ½åŠæ—¶å‘ç°é”™è¯¯

### 6.6 æ•°æ®ä¸è¿ç§»ï¼ˆLow Priorityï¼‰

#### TODO-16ï¼šæ¸…ç†å†å²æ•°æ®

- **çŠ¶æ€**ï¼šğŸŸ¡ è®¡åˆ’ä¸­
- **é¢„ä¼°æ—¶é—´**ï¼š1 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] å¯¼å‡ºå†å²æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰
  - [ ] åˆ é™¤æ— ç”¨çš„ TouchGal è¡¨
  - [ ] åˆå¹¶é‡å¤çš„ç”¨æˆ·æ•°æ®
  - [ ] å½’æ¡£å†å²å¸–å­
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `prisma/schema/*.prisma`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - æ•°æ®åº“ä½“ç§¯å‡å°
  - æŸ¥è¯¢æ€§èƒ½æå‡

#### TODO-17ï¼šå®Œå–„ç§å­æ•°æ®

- **çŠ¶æ€**ï¼šğŸŸ¡ è®¡åˆ’ä¸­
- **é¢„ä¼°æ—¶é—´**ï¼š0.5 å¤©
- **ä»»åŠ¡åˆ—è¡¨**ï¼š
  - [ ] æ‰©å±• `scripts/seedCourses.ts`
  - [ ] æ·»åŠ æ›´å¤šçœŸå®è¯¾ç¨‹æ•°æ®
  - [ ] æ·»åŠ æ•™å¸ˆä¿¡æ¯
  - [ ] ç”Ÿæˆæ›´å¤šæµ‹è¯•è¯„è®ºå’Œåé¦ˆ
- **æ¶‰åŠæ–‡ä»¶**ï¼š
  - `scripts/seedCourses.ts`
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - ç§å­æ•°æ®æ›´çœŸå®
  - èƒ½è¦†ç›–æ‰€æœ‰åŠŸèƒ½åœºæ™¯

---

## 7. å®è·µè·¯çº¿å›¾

### 7.1 åˆå­¦è€…ä¸Šæ‰‹æŒ‡å—ï¼ˆç¬¬ 1 å‘¨ï¼‰

#### Day 1-2ï¼šç¯å¢ƒæ­å»ºä¸ç†è§£

**ç›®æ ‡ï¼š** æˆåŠŸè¿è¡Œé¡¹ç›®ï¼Œç†è§£åŸºæœ¬æ¶æ„

**æ­¥éª¤ï¼š**

1. **å®‰è£…ä¾èµ–**

   ```bash
   pnpm install
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**

   ```bash
   cp .env.example .env
   ```

   å¡«å…¥ï¼š

   ```
   KUN_DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:5432/toki?schema=public
   NEXT_PUBLIC_KUN_PATCH_ADDRESS_DEV=http://127.0.0.1:3000
   NEXT_PUBLIC_DISABLE_CAPTCHA=true
   JWT_SECRET=please-change-me
   REDIS_HOST=127.0.0.1
   REDIS_PORT=6379
   ```

3. **åˆå§‹åŒ–æ•°æ®åº“**

   ```bash
   pnpm prisma:generate
   pnpm prisma:push
   ```

4. **å¯¼å…¥ç¤ºä¾‹æ•°æ®**

   ```bash
   pnpm run seed:courses
   ```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

   ```bash
   pnpm dev
   ```

6. **æµ‹è¯•ç™»å½•**
   - è®¿é—® `http://127.0.0.1:3000`
   - ä½¿ç”¨ `seed@example.com / 123` ç™»å½•

**å­¦ä¹ é‡ç‚¹ï¼š**

- ç†è§£ Next.js é¡¹ç›®ç»“æ„
- ç†è§£ Prisma çš„ä½œç”¨
- ç†è§£ç¯å¢ƒå˜é‡é…ç½®
- ç†è§£ç§å­æ•°æ®çš„æ¦‚å¿µ

**éªŒè¯æ ‡å‡†ï¼š**

- èƒ½æˆåŠŸè®¿é—®é¦–é¡µ
- èƒ½æˆåŠŸç™»å½•
- èƒ½è®¿é—®è¯¾ç¨‹è¯¦æƒ…é¡µ

#### Day 3-4ï¼šé˜…è¯»æ ¸å¿ƒä»£ç 

**ç›®æ ‡ï¼š** ç†è§£æ•°æ®æµå’Œç»„ä»¶å…³ç³»

**å¿…è¯»æ–‡ä»¶åˆ—è¡¨ï¼š**

1. **æ•°æ®åº“æ¨¡å‹**
   - `prisma/schema/course.prisma`ï¼ˆç†è§£è¯¾ç¨‹å®ä½“å…³ç³»ï¼‰
   - `prisma/schema/user.prisma`ï¼ˆç†è§£ç”¨æˆ·æ¨¡å‹ï¼‰

2. **API è·¯ç”±**
   - `app/api/course/[dept]/[slug]/route.ts`ï¼ˆç†è§£è¯¾ç¨‹è¯¦æƒ… APIï¼‰
   - `app/api/course/[dept]/[slug]/comment/route.ts`ï¼ˆç†è§£è¯„è®º APIï¼‰
   - `app/api/auth/login/route.ts`ï¼ˆç†è§£ç™»å½•æµç¨‹ï¼‰

3. **å‰ç«¯é¡µé¢**
   - `app/course/[dept]/[slug]/page.tsx`ï¼ˆç†è§£ Server Componentï¼‰
   - `components/course/Header.tsx`ï¼ˆç†è§£ Client Componentï¼‰

4. **å·¥å…·å‡½æ•°**
   - `utils/kunFetch.ts`ï¼ˆç†è§£ API è°ƒç”¨å°è£…ï¼‰
   - `validations/course.ts`ï¼ˆç†è§£ Zod éªŒè¯ï¼‰

**ç»ƒä¹ ä»»åŠ¡ï¼š**

- åœ¨è¯¾ç¨‹è¯¦æƒ…é¡µæ·»åŠ ä¸€ä¸ªå­—æ®µï¼ˆå¦‚"å­¦åˆ†"ï¼‰ï¼Œå¹¶æ›´æ–°æ•°æ®åº“
- ä¿®æ”¹è¯„è®ºçš„æœ€å¤§é•¿åº¦é™åˆ¶
- ä¸ºè¯¾ç¨‹æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ç­›é€‰åŠŸèƒ½

**éªŒè¯æ ‡å‡†ï¼š**

- èƒ½ç‹¬ç«‹ä¿®æ”¹ Prisma schema
- èƒ½æ·»åŠ æ–°çš„ API è·¯ç”±
- èƒ½åˆ›å»ºæ–°çš„é¡µé¢ç»„ä»¶

#### Day 5-7ï¼šå®è·µå°åŠŸèƒ½

**ç›®æ ‡ï¼š** ç‹¬ç«‹å®Œæˆä¸€ä¸ªå°åŠŸèƒ½

**ä»»åŠ¡é€‰é¡¹ 1ï¼šæ·»åŠ è¯¾ç¨‹æ”¶è—åŠŸèƒ½**

**æ­¥éª¤ï¼š**

1. åœ¨ `prisma/schema/course.prisma` æ·»åŠ æ¨¡å‹

   ```prisma
   model course_favorite {
     id        Int   @id @default(autoincrement())
     user_id   Int
     course_id Int
     created   DateTime @default(now())

     @@unique([user_id, course_id])
   }
   ```

2. åˆ›å»º API
   - `POST /api/course/[dept]/[slug]/favorite` - æ·»åŠ æ”¶è—
   - `DELETE /api/course/[dept]/[slug]/favorite` - å–æ¶ˆæ”¶è—

3. å‰ç«¯æ·»åŠ æŒ‰é’®
   - åœ¨ `components/course/Header.tsx` æ·»åŠ æ”¶è—æŒ‰é’®
   - ä½¿ç”¨ `kunFetchPost/Delete` è°ƒç”¨ API

**ä»»åŠ¡é€‰é¡¹ 2ï¼šæ·»åŠ èµ„æºè¯„åˆ†åŠŸèƒ½**

**æ­¥éª¤ï¼š**

1. åœ¨ `prisma/schema/course.prisma` å·²æœ‰ `resource_rating` æ¨¡å‹

2. åˆ›å»º API
   - `GET /api/course/[dept]/[slug]/resources` - è·å–èµ„æºï¼ˆåŒ…å«è¯„åˆ†ï¼‰
   - `POST /api/course/[dept]/[slug]/resources/[id]/rating` - æäº¤è¯„åˆ†

3. å‰ç«¯ä¿®æ”¹
   - `components/course/ResourceList.tsx` æ·»åŠ è¯„åˆ†æ˜¾ç¤º
   - `components/resource/ResourceCard.tsx` æ·»åŠ è¯„åˆ†æŒ‰é’®

**éªŒè¯æ ‡å‡†ï¼š**

- åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ•°æ®åº“æ­£ç¡®å­˜å‚¨
- å‰ç«¯æ­£ç¡®æ˜¾ç¤º

### 7.2 è¿›é˜¶å¼€å‘è·¯çº¿ï¼ˆç¬¬ 2-3 å‘¨ï¼‰

#### Week 2ï¼šå®ç°æ ¸å¿ƒåŠŸèƒ½

**ç›®æ ‡ï¼š** å®Œæˆ TODO-4ã€5ã€6ï¼ˆå­¦é™¢é¡µã€ç»éªŒå¸–ã€èµ„æºå®¡æ ¸ï¼‰

**å‘¨ä¸€-å‘¨äºŒï¼šå®ç°å­¦é™¢è¯¦æƒ…é¡µï¼ˆTODO-4ï¼‰**

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åˆ›å»º API**

   ```typescript
   // app/api/department/[slug]/route.ts
   export const GET = async (req: NextRequest, { params }) => {
     const { slug } = await params

     const department = await prisma.department.findUnique({
       where: { slug },
       include: {
         courses: {
           include: {
             _count: { select: { resources: true, posts: true } }
           }
         },
         _count: { select: { courses: true, teachers: true } }
       }
     })

     return NextResponse.json(department)
   }
   ```

2. **åˆ›å»ºé¡µé¢**

   ```typescript
   // app/department/[slug]/page.tsx
   export default async function Page({ params }) {
     const department = await getDepartment(params.slug)
     return <DepartmentHeader department={department} />
   }
   ```

3. **åˆ›å»ºç»„ä»¶**
   ```typescript
   // components/department/DepartmentHeader.tsx
   export const DepartmentHeader = ({ department }) => {
     return (
       <div>
         <h1>{department.name}</h1>
         <p>{department.description}</p>
         <div>
           <span>è¯¾ç¨‹æ•°: {department._count.courses}</span>
           <span>æ•™å¸ˆæ•°: {department._count.teachers}</span>
         </div>
         {department.courses.map(course => (
           <CourseCard key={course.id} course={course} />
         ))}
       </div>
     )
   }
   ```

**å‘¨ä¸‰-å‘¨å››ï¼šå®ç°ç»éªŒå¸–åŠŸèƒ½ï¼ˆTODO-5ï¼‰**

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **å®Œå–„ posts API**

   ```typescript
   // app/api/course/[dept]/[slug]/posts/route.ts
   export const GET = async (req: NextRequest, { params }) => {
     const { dept, slug } = await params
     const course = await getCourse(dept, slug)

     const posts = await prisma.post.findMany({
       where: { course_id: course.id },
       include: { author: true },
       orderBy: { created: 'desc' }
     })

     return NextResponse.json(posts)
   }

   export const POST = async (req: NextRequest, { params }) => {
     const payload = await verifyHeaderCookie(req)
     const input = await kunParsePostBody(req, postCreateSchema)
     const { dept, slug } = await params
     const course = await getCourse(dept, slug)

     const post = await prisma.post.create({
       data: {
         course_id: course.id,
         author_id: payload.uid,
         title: input.title,
         content: input.content,
         term: input.term
       }
     })

     // æ›´æ–°è¯¾ç¨‹å¸–å­ç»Ÿè®¡
     await prisma.course.update({
       where: { id: course.id },
       data: { post_count: { increment: 1 } }
     })

     return NextResponse.json(post)
   }
   ```

2. **åˆ›å»ºå‘å¸ƒé¡µé¢**

   ```typescript
   // app/course/[dept]/[slug]/posts/new/page.tsx
   'use client'

   import { useState } from 'react'
   import { kunFetchPost } from '~/utils/kunFetch'

   export default function NewPostPage() {
     const [title, setTitle] = useState('')
     const [content, setContent] = useState('')

     const onSubmit = async (e) => {
       e.preventDefault()
       await kunFetchPost(`/course/${dept}/${slug}/posts`, {
         title, content
       })
       router.push(`/course/${dept}/${slug}`)
     }

     return (
       <form onSubmit={onSubmit}>
         <input value={title} onChange={e => setTitle(e.target.value)} />
         <textarea value={content} onChange={e => setContent(e.target.value)} />
         <button type="submit">å‘å¸ƒ</button>
       </form>
     )
   }
   ```

**å‘¨äº”ï¼šå®ç°èµ„æºå®¡æ ¸åå°ï¼ˆTODO-6ï¼‰**

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åˆ›å»ºç®¡ç†é¡µé¢**

   ```typescript
   // app/admin/resources/page.tsx
   export default async function AdminResourcesPage() {
     const pendingResources = await prisma.resource.findMany({
       where: { status: 'pending' },
       include: { course: { include: { department: true } }, author: true },
       orderBy: { created: 'desc' }
     })

     return (
       <div>
         <h1>èµ„æºå®¡æ ¸</h1>
         {pendingResources.map(resource => (
           <div key={resource.id}>
             <h3>{resource.title}</h3>
             <p>è¯¾ç¨‹: {resource.course.department.slug}/{resource.course.slug}</p>
             <p>ä¸Šä¼ è€…: {resource.author.name}</p>
             <a href={resource.links[0]} target="_blank">é¢„è§ˆ</a>
             <button onClick={() => approve(resource.id)}>é€šè¿‡</button>
             <button onClick={() => reject(resource.id)}>æ‹’ç»</button>
           </div>
         ))}
       </div>
     )
   }
   ```

2. **åˆ›å»ºå®¡æ ¸ API**

   ```typescript
   // app/api/admin/resource/approve/route.ts
   export const POST = async (req: NextRequest) => {
     const payload = await verifyHeaderCookie(req)
     if (payload.role < 3) {
       return NextResponse.json('æ²¡æœ‰æƒé™', { status: 403 })
     }

     const { resourceId } = await kunParsePostBody(req, resourceIdSchema)

     await prisma.resource.update({
       where: { id: resourceId },
       data: { status: 'published' }
     })

     return NextResponse.json({ success: true })
   }
   ```

#### Week 3ï¼šä¼˜åŒ–ä¸å®Œå–„

**ç›®æ ‡ï¼š** å®Œæˆ TODO-7ã€8ã€9ï¼ˆæœç´¢ã€ç”¨æˆ·ä¸­å¿ƒã€äº’åŠ¨ç»Ÿè®¡ï¼‰

**å‘¨ä¸€-å‘¨äºŒï¼šæœç´¢åŠŸèƒ½ï¼ˆTODO-7ï¼‰**

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åˆ›å»ºæœç´¢ API**

   ```typescript
   // app/api/search/route.ts
   export const GET = async (req: NextRequest) => {
     const { keyword } = kunParseGetQuery(req, searchSchema)

     const [courses, resources] = await Promise.all([
       prisma.course.findMany({
         where: {
           OR: [
             { name: { contains: keyword, mode: 'insensitive' } },
             { description: { contains: keyword, mode: 'insensitive' } }
           ]
         },
         include: { department: true }
       }),
       prisma.resource.findMany({
         where: {
           OR: [
             { title: { contains: keyword, mode: 'insensitive' } },
             { summary: { contains: keyword, mode: 'insensitive' } }
           ]
         },
         include: { course: { include: { department: true } } }
       })
     ])

     return NextResponse.json({ courses, resources })
   }
   ```

2. **åˆ›å»ºæœç´¢é¡µé¢**

   ```typescript
   // app/search/page.tsx
   export default async function SearchPage({ searchParams }) {
     const keyword = searchParams.q
     const results = await search(keyword)

     return (
       <div>
         <h1>æœç´¢ "{keyword}"</h1>
         <h2>è¯¾ç¨‹</h2>
         {results.courses.map(course => (
           <CourseCard key={course.id} course={course} />
         ))}
         <h2>èµ„æº</h2>
         {results.resources.map(resource => (
           <ResourceCard key={resource.id} resource={resource} />
         ))}
       </div>
     )
   }
   ```

**å‘¨ä¸‰-å‘¨å››ï¼šç”¨æˆ·ä¸­å¿ƒï¼ˆTODO-8ï¼‰**

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **é‡å†™ç”¨æˆ·é¡µé¢**

   ```typescript
   // app/user/[id]/page.tsx
   export default async function UserPage({ params }) {
     const user = await prisma.user.findUnique({
       where: { id: params.id },
       include: {
         course_resource: { // ç”¨æˆ·ä¸Šä¼ çš„èµ„æº
           include: { course: { include: { department: true } } }
         },
         comments: { // ç”¨æˆ·å‚ä¸çš„è¯„è®º
           include: { course: true }
         },
         course_feedback: { // ç”¨æˆ·æäº¤çš„åé¦ˆ
           include: { course: true }
         }
       }
     })

     return (
       <div>
         <UserHeader user={user} />
         <Tabs>
           <Tab title="ä¸Šä¼ çš„èµ„æº">
             {user.course_resource.map(resource => (
               <ResourceCard key={resource.id} resource={resource} />
             ))}
           </Tab>
           <Tab title="å‚ä¸çš„è¯„è®º">
             {user.comments.map(comment => (
               <CommentCard key={comment.id} comment={comment} />
             ))}
           </Tab>
           <Tab title="è¯¾ç¨‹åé¦ˆ">
             {user.course_feedback.map(feedback => (
               <FeedbackCard key={feedback.id} feedback={feedback} />
             ))}
           </Tab>
         </Tabs>
       </div>
     )
   }
   ```

**å‘¨äº”ï¼šèµ„æºäº’åŠ¨ç»Ÿè®¡ï¼ˆTODO-9ï¼‰**

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **è®°å½•ç‚¹å‡»äº‹ä»¶**

   ```typescript
   // components/resource/ResourceCard.tsx
   const handleLinkClick = async (link) => {
     // è®°å½•ç‚¹å‡»
     await kunFetchPost('/resource/interaction', {
       resourceId,
       interaction: 'click'
     })

     // æ‰“å¼€é“¾æ¥
     window.open(link, '_blank')
   }
   ```

2. **åˆ›å»ºäº’åŠ¨ API**

   ```typescript
   // app/api/resource/interaction/route.ts
   export const POST = async (req: NextRequest) => {
     const payload = await verifyHeaderCookie(req)
     const { resourceId, interaction } = await kunParsePostBody(
       req,
       interactionSchema
     )

     await prisma.resource_interaction.create({
       data: {
         resource_id: resourceId,
         user_id: payload.uid,
         interaction
       }
     })

     // æ›´æ–°èµ„æºç»Ÿè®¡
     await prisma.resource.update({
       where: { id: resourceId },
       data: {
         click_count: { increment: 1 }
       }
     })

     return NextResponse.json({ success: true })
   }
   ```

### 7.3 é«˜çº§ä¼˜åŒ–è·¯çº¿ï¼ˆç¬¬ 4 å‘¨åŠä»¥åï¼‰

**ç›®æ ‡ï¼š** æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨åŠ å›ºã€æ¶æ„å‡çº§

#### Week 4ï¼šæ€§èƒ½ä¸å®‰å…¨

**å‘¨ä¸€-å‘¨äºŒï¼šAPI æ€§èƒ½ä¼˜åŒ–**

1. **æ·»åŠ ç¼ºå¤±ç´¢å¼•**

   ```sql
   -- æ£€æŸ¥æŸ¥è¯¢è®¡åˆ’
   EXPLAIN ANALYZE SELECT * FROM course WHERE department_id = 1;

   -- å¦‚æœéœ€è¦ï¼Œæ‰‹åŠ¨æ·»åŠ ç´¢å¼•
   CREATE INDEX IF NOT EXISTS idx_course_department_created ON course(department_id, created);
   ```

2. **ä¼˜åŒ– N+1 æŸ¥è¯¢**

   ```typescript
   // é”™è¯¯çš„å†™æ³•ï¼ˆN+1ï¼‰
   const courses = await prisma.course.findMany()
   for (const course of courses) {
     const resources = await prisma.resource.findMany({
       where: { course_id: course.id }
     })
   }

   // æ­£ç¡®çš„å†™æ³•ï¼ˆé¢„åŠ è½½ï¼‰
   const courses = await prisma.course.findMany({
     include: {
       resources: true
     }
   })
   ```

3. **æ·»åŠ  Redis ç¼“å­˜**

   ```typescript
   // app/api/utils/cache.ts
   import Redis from 'ioredis'

   const redis = new Redis({
     host: process.env.REDIS_HOST,
     port: parseInt(process.env.REDIS_PORT || '6379')
   })

   export const cacheGet = async (key: string) => {
     const data = await redis.get(key)
     return data ? JSON.parse(data) : null
   }

   export const cacheSet = async (key: string, value: any, ttl = 3600) => {
     await redis.setex(key, ttl, JSON.stringify(value))
   }

   // ä½¿ç”¨ç¼“å­˜
   export const GET = async (req: NextRequest) => {
     const cacheKey = 'course:list'
     let data = await cacheGet(cacheKey)

     if (!data) {
       data = await prisma.course.findMany()
       await cacheSet(cacheKey, data, 300) // ç¼“å­˜ 5 åˆ†é’Ÿ
     }

     return NextResponse.json(data)
   }
   ```

**å‘¨ä¸‰-å‘¨å››ï¼šå®‰å…¨åŠ å›º**

1. **å®ç° rate limiting**

   ```typescript
   // app/api/utils/rateLimit.ts
   import Redis from 'ioredis'

   const redis = new Redis()

   export const rateLimit = async (
     identifier: string,
     limit = 60,
     window = 60
   ) => {
     const key = `rate_limit:${identifier}`
     const current = await redis.incr(key)

     if (current === 1) {
       await redis.expire(key, window)
     }

     if (current > limit) {
       throw new Error('Rate limit exceeded')
     }

     return current
   }

   // åœ¨ç™»å½• API ä¸­ä½¿ç”¨
   export const POST = async (req: NextRequest) => {
     await rateLimit(req.ip || 'unknown', 5, 60) // æ¯åˆ†é’Ÿæœ€å¤š 5 æ¬¡

     // ç™»å½•é€»è¾‘...
   }
   ```

2. **è¾“å…¥éªŒè¯åŠ å¼º**
   ```typescript
   // ä¸¥æ ¼éªŒè¯æ‰€æœ‰è¾“å…¥
   const strictSchema = z.object({
     title: z
       .string()
       .min(1)
       .max(200)
       .regex(/^[\w\s\-_.]+$/, 'æ ‡é¢˜åŒ…å«éæ³•å­—ç¬¦'),
     content: z
       .string()
       .min(1)
       .max(10000)
       .refine((val) => {
         // é˜²æ­¢ XSS
         return !/<script|javascript:|on\w+=/i.test(val)
       }, 'å†…å®¹åŒ…å«éæ³•è„šæœ¬'),
     links: z.array(z.string().url()).max(10)
   })
   ```

**å‘¨äº”ï¼šç›‘æ§ä¸æ—¥å¿—**

1. **é›†æˆ Sentry**

   ```bash
   pnpm add @sentry/nextjs
   ```

   ```typescript
   // sentry.client.config.ts
   import * as Sentry from '@sentry/nextjs'

   Sentry.init({
     dsn: process.env.SENTRY_DSN,
     tracesSampleRate: 1.0
   })

   // åœ¨ API ä¸­æ•è·é”™è¯¯
   export const GET = async (req: NextRequest) => {
     try {
       const data = await riskyOperation()
       return NextResponse.json(data)
     } catch (error) {
       Sentry.captureException(error)
       return NextResponse.json(
         { error: 'Internal Server Error' },
         { status: 500 }
       )
     }
   }
   ```

2. **æ·»åŠ ç»“æ„åŒ–æ—¥å¿—**

   ```typescript
   // lib/logger.ts
   import winston from 'winston'

   const logger = winston.createLogger({
     level: 'info',
     format: winston.format.combine(
       winston.format.timestamp(),
       winston.format.json()
     ),
     transports: [
       new winston.transports.File({ filename: 'error.log', level: 'error' }),
       new winston.transports.File({ filename: 'combined.log' })
     ]
   })

   export default logger

   // ä½¿ç”¨
   logger.info('User logged in', { userId: user.id, ip: req.ip })
   ```

### 7.4 å­¦ä¹ èµ„æºæ¨è

#### å®˜æ–¹æ–‡æ¡£

- **Next.js**: https://nextjs.org/docs
- **Prisma**: https://www.prisma.io/docs
- **HeroUI**: https://www.heroui.com/
- **Tailwind CSS**: https://tailwindcss.com/docs
- **Zustand**: https://docs.pmnd.rs/zustand/
- **Zod**: https://zod.dev/

#### å®è·µé¡¹ç›®

- **Todo åº”ç”¨**ï¼šå­¦ä¹ åŸºç¡€ CRUD
- **åšå®¢ç³»ç»Ÿ**ï¼šå­¦ä¹ æ–‡ç« å‘å¸ƒ
- **èŠå¤©å®¤**ï¼šå­¦ä¹  WebSocket
- **ç”µå•†ç½‘ç«™**ï¼šå­¦ä¹ å¤æ‚ä¸šåŠ¡é€»è¾‘

#### æ¨èä¹¦ç±

- ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹
- ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹
- ã€Šé«˜æ€§èƒ½ MySQLã€‹
- ã€Šè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€‹

---

## 8. å¸¸è§é—®é¢˜è§£ç­”

### Q1ï¼šå¦‚ä½•ç†è§£ Next.js çš„ Server Component å’Œ Client Componentï¼Ÿ

**Aï¼š**

- **Server Component**ï¼šé»˜è®¤æ˜¯æœåŠ¡ç«¯ç»„ä»¶
  - ä¼˜ç‚¹ï¼šå¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œæ— éœ€ API è°ƒç”¨ï¼ŒSEO å‹å¥½
  - é™åˆ¶ï¼šä¸èƒ½ä½¿ç”¨æµè§ˆå™¨ APIï¼ˆwindowã€documentï¼‰ï¼Œä¸èƒ½æœ‰äº¤äº’
  - é€‚ç”¨ï¼šé¡µé¢æ¡†æ¶ã€æ•°æ®è·å–ã€å±•ç¤ºé™æ€å†…å®¹

- **Client Component**ï¼šä»¥ `'use client'` å¼€å¤´
  - ä¼˜ç‚¹ï¼šå¯ä»¥æœ‰äº¤äº’ã€ä½¿ç”¨æµè§ˆå™¨ APIã€çŠ¶æ€ç®¡ç†
  - é™åˆ¶ï¼šä¸èƒ½ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œéœ€è¦é€šè¿‡ API
  - é€‚ç”¨ï¼šæŒ‰é’®ã€è¡¨å•ã€å¼¹çª—ã€åŠ¨æ€æ•ˆæœ

**ç¤ºä¾‹å¯¹æ¯”ï¼š**

```typescript
// Server Component - é¡µé¢æ¡†æ¶
// app/course/[id]/page.tsx
export default async function Page({ params }) {
  const course = await getCourse(params.id) // ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
  return <CourseHeader course={course} />
}

// Client Component - äº¤äº’ç»„ä»¶
// components/course/Header.tsx
'use client'
import { useState } from 'react'

export const CourseHeader = ({ course }) => {
  const [liked, setLiked] = useState(false)

  const handleLike = () => {
    setLiked(!liked)
    // å¯ä»¥è°ƒç”¨ API
  }

  return (
    <div>
      <h1>{course.name}</h1>
      <button onClick={handleLike}>{liked ? 'â¤ï¸' : 'ğŸ¤'}</button>
    </div>
  )
}
```

### Q2ï¼šPrisma çš„ `include` å’Œ `select` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**Aï¼š**

- `include`ï¼šåŒ…å«å…³è”è¡¨çš„å®Œæ•´è®°å½•

  ```typescript
  const course = await prisma.course.findUnique({
    where: { id: 1 },
    include: {
      department: true, // åŒ…å«æ•´ä¸ª department å¯¹è±¡
      resources: true // åŒ…å«æ‰€æœ‰ resources æ•°ç»„
    }
  })
  // ç»“æœ: { id: 1, name: '...', department: { id: 1, name: '...' }, resources: [...] }
  ```

- `select`ï¼šåªé€‰æ‹©ç‰¹å®šå­—æ®µ
  ```typescript
  const course = await prisma.course.findUnique({
    where: { id: 1 },
    select: {
      id: true,
      name: true,
      department: { select: { name: true } } // åµŒå¥—é€‰æ‹©
    }
  })
  // ç»“æœ: { id: 1, name: '...', department: { name: '...' } }
  ```

**æœ€ä½³å®è·µï¼š**

- éœ€è¦å…³è”æ•°æ®æ—¶ä½¿ç”¨ `include`
- åªéœ€è¦éƒ¨åˆ†å­—æ®µæ—¶ä½¿ç”¨ `select`ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
- é¿å… `include` ä¸éœ€è¦çš„å…³è”ï¼ˆæµªè´¹å¸¦å®½ï¼‰

### Q3ï¼šå¦‚ä½•é¿å… N+1 æŸ¥è¯¢é—®é¢˜ï¼Ÿ

**Aï¼š**

**é—®é¢˜ç¤ºä¾‹ï¼š**

```typescript
// âŒ é”™è¯¯çš„å†™æ³•ï¼ˆN+1ï¼‰
const courses = await prisma.course.findMany() // æŸ¥è¯¢ 1 æ¬¡
courses.forEach(async (course) => {
  // å¾ªç¯ N æ¬¡
  const resources = await prisma.resource.findMany({
    where: { course_id: course.id }
  })
  console.log(resources)
})
// æ€»è®¡ï¼š1 + N æ¬¡æŸ¥è¯¢
```

**è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `include` æˆ– `hasMany` å…³ç³»**

```typescript
// âœ… æ­£ç¡®å†™æ³•ï¼ˆé¢„åŠ è½½ï¼‰
const courses = await prisma.course.findMany({
  include: {
    resources: true // é€šè¿‡å…³ç³»é¢„åŠ è½½
  }
})
courses.forEach((course) => {
  console.log(course.resources) // å·²ç»åŠ è½½ï¼Œæ— éœ€é¢å¤–æŸ¥è¯¢
})
// æ€»è®¡ï¼š1 æ¬¡æŸ¥è¯¢
```

**æ£€æŸ¥ N+1 é—®é¢˜ï¼š**

```typescript
// å¼€å¯æ—¥å¿—
const prisma = new PrismaClient({
  log: ['query', 'info', 'warn', 'error']
})

// æˆ–ä½¿ç”¨ Prisma Accelerate çš„æŸ¥è¯¢æ´å¯Ÿ
```

### Q4ï¼šå¦‚ä½•ç†è§£ `kunFetch` çš„è®¾è®¡ï¼Ÿ

**Aï¼š**

**æ ¸å¿ƒæ€æƒ³ï¼š** ç»Ÿä¸€ API è°ƒç”¨ï¼Œé¿å…é‡å¤ä»£ç 

**è®¾è®¡ç‰¹ç‚¹ï¼š**

1. **è‡ªåŠ¨ç¯å¢ƒé…ç½®**

   ```typescript
   let fetchAddress =
     process.env.NODE_ENV === 'development'
       ? process.env.NEXT_PUBLIC_KUN_PATCH_ADDRESS_DEV
       : process.env.NEXT_PUBLIC_KUN_PATCH_ADDRESS_PROD

   if (!fetchAddress) {
     if (typeof window !== 'undefined') {
       fetchAddress = window.location.origin // è‡ªåŠ¨é™çº§
     }
   }
   ```

2. **é»˜è®¤æºå¸¦ Cookie**

   ```typescript
   const fetchOptions: RequestInit = {
     method,
     credentials: 'include', // è‡ªåŠ¨æºå¸¦ Cookie
     mode: 'cors',
     headers: hdrs
   }
   ```

3. **é”™è¯¯é‡è¯•æœºåˆ¶**
   ```typescript
   let attempt = 0
   while (attempt <= retries) {
     try {
       const response = await fetch(fullUrl, fetchOptions)
       // å¤„ç†å“åº”...
     } catch (error) {
       if (attempt > retries) throw error
       await wait(300 * attempt) // æŒ‡æ•°é€€é¿
       attempt++
     }
   }
   ```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
// GET è¯·æ±‚
const courses = await kunFetchGet('/course/list', {
  page: 1,
  pageSize: 20
})

// POST è¯·æ±‚
const newComment = await kunFetchPost('/course/cs/signal/comment', {
  courseId: 1,
  content: 'Hello'
})

// DELETE è¯·æ±‚
await kunFetchDelete('/course/cs/signal/comment', {
  commentId: 123
})
```

### Q5ï¼šå¦‚ä½•ç†è§£åµŒå¥—è¯„è®ºçš„å®ç°ï¼Ÿ

**Aï¼š**

**æ•°æ®ç»“æ„ï¼š**

```typescript
// æ•°æ®åº“å­˜å‚¨ï¼ˆæ‰å¹³åŒ–ï¼‰
id | content      | parent_id
---|-------------|----------
1  | ä¸»è¯„è®º1     | null
2  | å›å¤1-1     | 1
3  | å›å¤1-2     | 1
4  | å›å¤2-1     | 2
5  | ä¸»è¯„è®º2     | null

// æ ‘å½¢ç»“æ„ï¼ˆå®¢æˆ·ç«¯å±•ç¤ºï¼‰
ä¸»è¯„è®º1
â”œâ”€ å›å¤1-1
â”‚  â””â”€ å›å¤2-1
â””â”€ å›å¤1-2
ä¸»è¯„è®º2
```

**è½¬æ¢é€»è¾‘ï¼š**

```typescript
// app/api/course/[dept]/[slug]/comment/_helpers.ts
export const nestCourseComments = (
  comments: PatchComment[]
): PatchComment[] => {
  const map = new Map<number, PatchComment>()
  const roots: PatchComment[] = []

  // 1. åˆ›å»º Mapï¼Œåˆå§‹åŒ– reply æ•°ç»„
  comments.forEach((c) => {
    map.set(c.id, { ...c, reply: [] })
  })

  // 2. åˆ†æ‹£åˆ°çˆ¶çº§æˆ–æ ¹çº§
  map.forEach((comment) => {
    if (comment.parentId) {
      const parent = map.get(comment.parentId)
      parent?.reply.push(comment)
    } else {
      roots.push(comment)
    }
  })

  return roots
}
```

**å‰ç«¯æ¸²æŸ“ï¼ˆé€’å½’ï¼‰ï¼š**

```typescript
const renderComments = (list: PatchComment[], depth = 0) =>
  list.map((comment) => (
    <div key={comment.id} style={{ marginLeft: depth * 20 }}>
      <div>{comment.content}</div>
      {comment.reply && comment.reply.length > 0 && (
        <>{renderComments(comment.reply, depth + 1)}</>
      )}
    </div>
  ))
```

### Q6ï¼šå¦‚ä½•ç†è§£ `content_status` å’Œ `visibility` çš„è®¾è®¡ï¼Ÿ

**Aï¼š**

**content_statusï¼ˆå†…å®¹çŠ¶æ€ï¼‰ï¼š**

```prisma
enum content_status {
  draft    // è‰ç¨¿ï¼ˆä½œè€…å¯è§ï¼Œæœªå‘å¸ƒï¼‰
  pending  // å¾…å®¡æ ¸ï¼ˆä½œè€…å¯è§ï¼Œç®¡ç†å‘˜å¯å®¡æ ¸ï¼‰
  published // å·²å‘å¸ƒï¼ˆæ‰€æœ‰äººå¯è§ï¼‰
  rejected // å·²æ‹’ç»ï¼ˆä½œè€…å¯è§ï¼Œéœ€ä¿®æ”¹ï¼‰
}
```

**visibilityï¼ˆå¯è§æ€§ï¼‰ï¼š**

```prisma
enum visibility {
  public    // å…¬å¼€ï¼ˆæ‰€æœ‰äººå¯è§ï¼Œå¯æœç´¢ï¼‰
  unlisted  // éšè—ï¼ˆçŸ¥é“é“¾æ¥æ‰èƒ½è®¿é—®ï¼‰
  private   // ç§æœ‰ï¼ˆä»…ä½œè€…å’Œç®¡ç†å‘˜å¯è§ï¼‰
}
```

**ç»„åˆä½¿ç”¨ç¤ºä¾‹ï¼š**

| åœºæ™¯       | status    | visibility | è¯´æ˜                   |
| ---------- | --------- | ---------- | ---------------------- |
| æ™®é€šèµ„æº   | published | public     | æ­£å¸¸å‘å¸ƒçš„å…¬å¼€èµ„æº     |
| ç§å¯†èµ„æº   | published | private    | ä»…ä½œè€…å’Œç®¡ç†å‘˜å¯è§     |
| å¾…å®¡æ ¸èµ„æº | pending   | public     | ç®¡ç†å‘˜å®¡æ ¸åæ‰ä¼šå…¬å¼€   |
| è‰ç¨¿èµ„æº   | draft     | private    | ä½œè€…å¯ç¼–è¾‘ï¼Œä»–äººä¸å¯è§ |
| å®¡æ ¸æ‹’ç»   | rejected  | public     | å®¡æ ¸ä¸é€šè¿‡ï¼Œä½œè€…éœ€ä¿®æ”¹ |

**æŸ¥è¯¢ç¤ºä¾‹ï¼š**

```typescript
// ç”¨æˆ·æµè§ˆè¯¾ç¨‹èµ„æºï¼ˆåªæ˜¾ç¤ºå·²å‘å¸ƒçš„ï¼‰
const resources = await prisma.resource.findMany({
  where: {
    course_id: courseId,
    status: 'published',
    visibility: 'public'
  }
})

// ä½œè€…æŸ¥çœ‹è‡ªå·±çš„èµ„æºï¼ˆåŒ…å«è‰ç¨¿å’Œå¾…å®¡æ ¸ï¼‰
const myResources = await prisma.resource.findMany({
  where: {
    author_id: userId
  }
})

// ç®¡ç†å‘˜æŸ¥çœ‹å¾…å®¡æ ¸èµ„æº
const pendingResources = await prisma.resource.findMany({
  where: {
    status: 'pending'
  }
})
```

### Q7ï¼šå¦‚ä½•ç†è§£ JWT å’Œ Cookie çš„å…³ç³»ï¼Ÿ

**Aï¼š**

**JWTï¼ˆJSON Web Tokenï¼‰ï¼š**

- ä¸€ç§è®¤è¯æ ‡å‡†ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä¼ é€’ç»è¿‡éªŒè¯çš„ä¿¡æ¯
- ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šHeader.Payload.Signature
- åŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼ˆuidã€nameã€roleï¼‰å’Œè¿‡æœŸæ—¶é—´

**Cookie å­˜å‚¨ JWTï¼š**

```typescript
// ç™»å½•æˆåŠŸåè®¾ç½® Cookie
const token = await generateKunToken(user.id, user.name, user.role, '30d')

cookie.set('toki-nwpushare-access-token', token, {
  httpOnly: true, // é˜²æ­¢ JavaScript è®¿é—®ï¼ˆå®‰å…¨ï¼‰
  sameSite: 'strict', // é˜²æ­¢ CSRF æ”»å‡»
  maxAge: 30 * 24 * 60 * 60 * 1000 // 30 å¤©
})
```

**éªŒè¯æµç¨‹ï¼š**

```typescript
// 1. å‰ç«¯å‘é€è¯·æ±‚ï¼ˆè‡ªåŠ¨æºå¸¦ Cookieï¼‰
await fetch('/api/course/list', {
  credentials: 'include'
})

// 2. åç«¯éªŒè¯
export const verifyHeaderCookie = async (req: Request) => {
  const cookie = await cookies()
  const token = cookie.get('toki-nwpushare-access-token')?.value

  if (!token) return null

  try {
    const payload = await verifyKunToken(token)
    return payload // { uid, name, role, exp, ... }
  } catch {
    return null
  }
}

// 3. åœ¨ API ä¸­ä½¿ç”¨
export const GET = async (req: NextRequest) => {
  const user = await verifyHeaderCookie(req)
  if (!user) {
    return NextResponse.json('æœªç™»å½•', { status: 401 })
  }
  // ä¸šåŠ¡é€»è¾‘...
}
```

**2FAï¼ˆåŒå› å­è®¤è¯ï¼‰æµç¨‹ï¼š**

```typescript
// 1. ç”¨æˆ·è¾“å…¥å¯†ç åï¼Œå¦‚æœå¯ç”¨ 2FA
if (user.enable_2fa) {
  // ç”Ÿæˆä¸´æ—¶ Tokenï¼Œ10 åˆ†é’Ÿè¿‡æœŸ
  const tempToken = generateKunStatelessToken(
    { id: user.id, require2FA: true },
    10 * 60
  )

  // è®¾ç½®ä¸´æ—¶ Cookie
  cookie.set('kun-galgame-patch-moe-2fa-token', tempToken, {
    httpOnly: true,
    sameSite: 'strict',
    maxAge: 10 * 60 * 1000
  })

  return { require2FA: true } // è¦æ±‚éªŒè¯ 2FA
}

// 2. ç”¨æˆ·è¾“å…¥ 2FA ä»£ç 
export const POST = async (req: NextRequest) => {
  const tempToken = cookie.get('kun-galgame-patch-moe-2fa-token')?.value
  const { code } = await kunParsePostBody(req, twoFaSchema)

  const payload = await verifyKunToken(tempToken)
  if (payload.require2FA) {
    // éªŒè¯ 2FA ä»£ç 
    const isValid = await verify2FA(code, user.two_factor_secret)
    if (isValid) {
      // ç”Ÿæˆæ­£å¼ Token
      const token = await generateKunToken(user.id, ...)
      cookie.set('toki-nwpushare-access-token', token, ...)
      return NextResponse.json(userInfo)
    }
  }
}
```

### Q8ï¼šå¦‚ä½•ç†è§£ `kunParseGetQuery` å’Œ `kunParsePostBody`ï¼Ÿ

**Aï¼š**

è¿™äº›æ˜¯è‡ªå®šä¹‰çš„å·¥å…·å‡½æ•°ï¼Œç”¨äºè§£æ HTTP è¯·æ±‚å‚æ•°ï¼š

**kunParseGetQueryï¼ˆè§£æ GET å‚æ•°ï¼‰ï¼š**

```typescript
// å‰ç«¯å‘é€ GET è¯·æ±‚
await fetch('/api/course/list?page=1&pageSize=20&keyword=ä¿¡å·')

// åç«¯è§£æ
import { kunParseGetQuery } from '~/app/api/utils/parseQuery'

const QuerySchema = z.object({
  page: z.coerce.number().int().min(1).optional(),
  pageSize: z.coerce.number().int().min(1).max(100).optional(),
  keyword: z.string().optional()
})

export const GET = async (req: NextRequest) => {
  const parsed = kunParseGetQuery(req, QuerySchema)
  // parsed: { page: 1, pageSize: 20, keyword: 'ä¿¡å·' }
}
```

**kunParsePostBodyï¼ˆè§£æ POST å‚æ•°ï¼‰ï¼š**

```typescript
// å‰ç«¯å‘é€ POST è¯·æ±‚
await fetch('/api/course/cs/signal/comment', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    courseId: 1,
    content: 'Hello'
  })
})

// åç«¯è§£æ
import { kunParsePostBody } from '~/app/api/utils/parseQuery'

const CreateSchema = z.object({
  courseId: z.number(),
  content: z.string().min(1)
})

export const POST = async (req: NextRequest) => {
  const parsed = await kunParsePostBody(req, CreateSchema)
  // parsed: { courseId: 1, content: 'Hello' }
}
```

**kunParsePutBody/DeleteQueryï¼š** ç±»ä¼¼ï¼Œåˆ†åˆ«ç”¨äº PUT è¯·æ±‚å’Œ DELETE è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ã€‚

**å¥½å¤„ï¼š**

1. **è‡ªåŠ¨ç±»å‹è½¬æ¢**ï¼š`z.coerce.number()` å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—
2. **å‚æ•°éªŒè¯**ï¼šä¸æ»¡è¶³ Zod schema ä¼šè¿”å›é”™è¯¯
3. **é»˜è®¤å€¼**ï¼š`optional()` å‚æ•°æœªæä¾›æ—¶ä¸º undefined
4. **ç±»å‹å®‰å…¨**ï¼šè¿”å›ç±»å‹è¢«æ¨æ–­ä¸º `z.infer<typeof Schema>`

### Q9ï¼šå¦‚ä½•ç†è§£ `zod-form-data` å’Œ `formData` ä¸Šä¼ ï¼Ÿ

**Aï¼š**

**Zod è¡¨å•éªŒè¯ï¼š**

```typescript
// validations/resource.ts
export const uploadResourceSchema = z.object({
  title: z.string().min(1),
  file: z.custom<File>() // è‡ªå®šä¹‰ File ç±»å‹éªŒè¯
})

// å¤„ç†è¡¨å•ä¸Šä¼ 
export const POST = async (req: NextRequest) => {
  const formData = await req.formData()
  const parsed = uploadResourceSchema.parse(formData)

  const file = parsed.file
  const arrayBuffer = await file.arrayBuffer()
  const buffer = Buffer.from(arrayBuffer)

  // ä¸Šä¼ åˆ° S3 æˆ–æœ¬åœ°å­˜å‚¨
  await uploadToS3(buffer, file.name)

  return NextResponse.json({ success: true })
}
```

**å‰ç«¯å‘é€è¡¨å•ï¼š**

```typescript
// å®¢æˆ·ç«¯
const onSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
  e.preventDefault()
  const formData = new FormData(e.currentTarget)

  await fetch('/api/upload/resource', {
    method: 'POST',
    body: formData
  })
}

return (
  <form onSubmit={onSubmit}>
    <input name="title" />
    <input type="file" name="file" />
    <button type="submit">ä¸Šä¼ </button>
  </form>
)
```

### Q10ï¼šå¦‚ä½•ç†è§£ `course_feedback` çš„ `@@unique([course_id, user_id])`ï¼Ÿ

**Aï¼š**

è¿™æ˜¯ Prisma çš„å¤åˆå”¯ä¸€çº¦æŸï¼š

```prisma
model course_feedback {
  id         Int      @id @default(autoincrement())
  course_id  Int
  user_id    Int
  liked      Boolean
  difficulty Int?

  @@unique([course_id, user_id]) // å¤åˆå”¯ä¸€çº¦æŸ
}
```

**å«ä¹‰ï¼š**

- æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªè¯¾ç¨‹åªèƒ½æœ‰ä¸€æ¡åé¦ˆè®°å½•
- ç›¸å½“äº `(course_id, user_id)` æ˜¯å”¯ä¸€é”®

**ä½œç”¨ï¼š**

1. **é˜²æ­¢é‡å¤æäº¤**ï¼šç”¨æˆ·å¤šæ¬¡ç‚¹å‡»çº¢å¿ƒï¼Œåªæ›´æ–°ç°æœ‰è®°å½•
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿ç»Ÿè®¡æ•°æ®å‡†ç¡®
3. **ç´¢å¼•ä¼˜åŒ–**ï¼š`unique` è‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½

**ä½¿ç”¨ `upsert`ï¼š**

```typescript
const feedback = await prisma.course_feedback.upsert({
  where: { course_id_user_id: { course_id: 1, user_id: 2 } },
  update: { liked: true, difficulty: 5 },
  create: { course_id: 1, user_id: 2, liked: true, difficulty: 5 }
})

// ç­‰ä»·äºï¼š
// SELECT * FROM course_feedback WHERE course_id=1 AND user_id=2
// å¦‚æœå­˜åœ¨ â†’ UPDATE
// å¦‚æœä¸å­˜åœ¨ â†’ INSERT
```

**æ— çº¦æŸçš„é—®é¢˜ï¼š**

```sql
-- å¦‚æœæ²¡æœ‰å”¯ä¸€çº¦æŸï¼Œæ•°æ®å¯èƒ½é‡å¤
INSERT INTO course_feedback (course_id, user_id, liked) VALUES (1, 2, true);
INSERT INTO course_feedback (course_id, user_id, liked) VALUES (1, 2, false);
-- ç»“æœï¼šç”¨æˆ·å¯¹åŒä¸€è¯¾ç¨‹æœ‰ä¸¤æ¡åé¦ˆï¼Œç»Ÿè®¡æ•°æ®é”™è¯¯
```

---

## ğŸ‰ æ€»ç»“

è¿™ä»½æŒ‡å—æ¶µç›–äº† NWPUShare çš„æ‰€æœ‰æ ¸å¿ƒå†…å®¹ï¼Œä»åŸºç¡€æ¶æ„åˆ°é«˜çº§ä¼˜åŒ–ã€‚å»ºè®®çš„å­¦ä¹ è·¯å¾„ï¼š

1. **ç¬¬ 1 å‘¨**ï¼šç¯å¢ƒæ­å»ºï¼Œç†è§£ Next.js App Router å’Œ Prisma
2. **ç¬¬ 2 å‘¨**ï¼šå®ç°å­¦é™¢é¡µå’Œç»éªŒå¸–åŠŸèƒ½
3. **ç¬¬ 3 å‘¨**ï¼šå®ç°æœç´¢å’Œç”¨æˆ·ä¸­å¿ƒ
4. **ç¬¬ 4 å‘¨**ï¼šæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨åŠ å›º

é‡åˆ°é—®é¢˜æ—¶ï¼Œä¼˜å…ˆæŸ¥é˜…ï¼š

1. **å®˜æ–¹æ–‡æ¡£**ï¼ˆNext.jsã€Prismaã€HeroUI ç­‰ï¼‰
2. **æºç æ³¨é‡Š**
3. **ç°æœ‰å®ç°ç¤ºä¾‹**

è®°ä½ï¼š**å®è·µæ˜¯æœ€å¥½çš„è€å¸ˆ**ã€‚ä¸è¦åªçœ‹ä¸ç»ƒï¼Œä¸€å®šè¦åŠ¨æ‰‹å†™ä»£ç ï¼

ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ ğŸš€

---

**æœ€åæ›´æ–°ï¼š** 2025-11-19
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**ç»´æŠ¤è€…ï¼š** NWPUShare å›¢é˜Ÿ
